{"version":3,"sources":["assets\\scripts\\game\\DropBox.js"],"names":["cc","Class","Component","properties","boxIndex","_showToPlayer","progressBar","ProgressBar","_beginOpen","_hadOpen","_openTimer","_belongTagsArr","other","onLoad","init","_index","update","dt","GameApp","eventManager","emit","EventNames","EVENT_NOTYFY_BOX_DISMISS","toString","length","indexOf","Tags","player","EVENT_SHOW_BOXITEM","node","getComponent","enemyEquipBoxItem","progress","onBeginContact","contact","self","tag","enemy","push","onEndContact","Tools","removeArray"],"mappings":"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","sourceRoot":"/","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        boxIndex: 1231231,\r\n        _showToPlayer: false,\r\n        progressBar: cc.ProgressBar,\r\n        _beginOpen: false,\r\n        _hadOpen: false,\r\n        _openTimer: 0,\r\n        _belongTagsArr: [],\r\n        other: null,\r\n    },\r\n\r\n\r\n    onLoad() {\r\n        this._belongTagsArr = []\r\n    },\r\n    init(_index) {\r\n        // console.log(_index)\r\n        this.boxIndex = _index\r\n    },\r\n    update(dt) {\r\n        if (this._hadOpen) return\r\n\r\n        if (this._beginOpen) {\r\n            this._openTimer += dt\r\n            if (this._openTimer >= 5) {\r\n                if (this._hadOpen) return\r\n                this._hadOpen = true\r\n                GameApp.eventManager.emit(EventNames.EVENT_NOTYFY_BOX_DISMISS, this.boxIndex.toString())\r\n                if (this._belongTagsArr.length == 0) return\r\n                if (this._belongTagsArr.indexOf(Tags.player) != -1) {\r\n                    GameApp.eventManager.emit(EventNames.EVENT_SHOW_BOXITEM)\r\n                } else {\r\n                    // console.log(\"触发了\")\r\n                    this.other && this.other.node.getComponent(\"Enemy\").enemyEquipBoxItem()\r\n                }\r\n            }\r\n\r\n        } else {\r\n            this._openTimer -= dt\r\n            if (this._openTimer < 0) {\r\n                this._openTimer = 0\r\n            }\r\n        }\r\n        this.progressBar.progress = this._openTimer / 5\r\n    },\r\n    onBeginContact(contact, self, other) {\r\n        if (other.tag == Tags.player || other.tag >= Tags.enemy) {\r\n            this._beginOpen = true\r\n\r\n            if (this._belongTagsArr.indexOf(other.tag) == -1) {\r\n                this._belongTagsArr.push(other.tag)\r\n            }\r\n        }\r\n    },\r\n\r\n    onEndContact(contact, self, other) {\r\n        if (other.tag == Tags.player || other.tag >= Tags.enemy) {\r\n            if (this._openTimer >= 5) {\r\n                this.other = other\r\n                if (this._hadOpen) return\r\n                this._hadOpen = true\r\n                GameApp.eventManager.emit(EventNames.EVENT_NOTYFY_BOX_DISMISS, this.boxIndex.toString())\r\n                if (this._belongTagsArr.length == 0) return\r\n                if (this._belongTagsArr.indexOf(Tags.player) != -1) {\r\n                    GameApp.eventManager.emit(EventNames.EVENT_SHOW_BOXITEM)\r\n                } else {\r\n                    // console.log(\"触发了\")\r\n                    other.node.getComponent(\"Enemy\").enemyEquipBoxItem()\r\n                }\r\n                return\r\n            }\r\n\r\n\r\n            if (this._belongTagsArr.indexOf(other.tag) != -1) {\r\n                Tools.removeArray(this._belongTagsArr, other.tag)\r\n            }\r\n            if (this._belongTagsArr.length == 0) {\r\n                this._beginOpen = false\r\n            }\r\n        }\r\n    },\r\n\r\n});\r\n"]}