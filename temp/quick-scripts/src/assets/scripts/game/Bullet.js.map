{"version":3,"sources":["assets\\scripts\\game\\Bullet.js"],"names":["cc","Class","Component","properties","_belongTag","_belongName","gunData","_pbc","PhysicsBoxCollider","_doFly","_flyDir","v2","_flySpeed","_maxRange","_curRange","_power","_isCrit","_onceExec","bulletAtlas","SpriteAtlas","onLoad","node","getComponent","init","_data","_isDef","cloneId","weaponid","Sprite","spriteFrame","getSpriteFrame","speed","range","size","enabled","update","dt","x","y","mag","apply","doAnim","runAction","sequence","delayTime","callFunc","bsp","spIndex","tempSp","destroy","repeatForever","onBeginContact","contact","self","other","tag","Tags","collider","player","enemy"],"mappings":"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","sourceRoot":"/","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        _belongTag: -1,//区分子弹是哪个角色打出来的\r\n        _belongName: \"\",//射出子弹角色名，用于展示击杀信息\r\n        gunData: {\r\n            default: {}\r\n        },\r\n        _pbc: cc.PhysicsBoxCollider,\r\n        _doFly: false,\r\n        _flyDir: {\r\n            default: cc.v2(0, 0),\r\n        },\r\n        _flySpeed: 0,\r\n        _maxRange: 500,\r\n        _curRange: 0,\r\n        _power: 0,\r\n        _isCrit: false,\r\n        _onceExec: true,\r\n        bulletAtlas: cc.SpriteAtlas,\r\n\r\n    },\r\n    onLoad() {\r\n        this._pbc = this.node.getComponent(cc.PhysicsBoxCollider)\r\n        // setTimeout(function () {\r\n        //     this.node && this.node.destroy()\r\n        // }.bind(this), 4000)\r\n    },\r\n    init(_data, _power, _isCrit, _isDef) {\r\n        this.gunData = _data\r\n        this._power = _power\r\n        this._isCrit = _isCrit\r\n        var cloneId = this.gunData.weaponid\r\n        if (cloneId > 1100) {\r\n            cloneId -= 100\r\n        }\r\n        this.getComponent(cc.Sprite).spriteFrame = this.bulletAtlas.getSpriteFrame(cloneId + 1000)\r\n        this._flySpeed = this.gunData.speed\r\n        this._maxRange = this.gunData.range\r\n        this._pbc.size = new cc.size(60, 30)\r\n        this._pbc.enabled = true\r\n        this._doFly = true\r\n    },\r\n    update(dt) {\r\n        if (this._doFly) {\r\n            this.node.x += this._flyDir.x * this._flySpeed * dt\r\n            this.node.y += this._flyDir.y * this._flySpeed * dt\r\n            this._curRange += this._flyDir.mag() * dt * 1000\r\n            // console.log(this._curRange)\r\n            if (this._curRange > this._maxRange) {\r\n                if (this.gunData.weaponid == 1005 || this.gunData.weaponid == 1105) {\r\n                    this._pbc.size = new cc.size(120, 120)\r\n                    this._pbc.apply()\r\n                }\r\n                this._doFly = false\r\n            }\r\n        } else {\r\n            this.doAnim()\r\n        }\r\n    },\r\n    doAnim() {\r\n        if (!this._onceExec) return\r\n        this._onceExec = false\r\n        this.node.runAction(cc.sequence(cc.delayTime(0.1), cc.callFunc(() => {\r\n            this._pbc.enabled = false\r\n        })))\r\n        var bsp = this.getComponent(cc.Sprite)\r\n        var spIndex = 1\r\n        this.node.runAction(cc.sequence(cc.callFunc(() => {\r\n            var cloneId = this.gunData.weaponid\r\n            if (cloneId > 1100) {\r\n                cloneId -= 100\r\n            }\r\n            var tempSp = this.bulletAtlas.getSpriteFrame(cloneId + 1000 + '_' + spIndex)\r\n            if (tempSp != null) {\r\n                bsp.spriteFrame = tempSp\r\n                ++spIndex\r\n            } else {\r\n                this.node.destroy()\r\n            }\r\n        }), cc.delayTime(0.1)).repeatForever())\r\n    },\r\n    onBeginContact(contact, self, other) {\r\n        if (other.tag == this._belongTag) return\r\n        if (other.tag == Tags.collider || other.tag == Tags.player || other.tag >= Tags.enemy) {\r\n            // console.log(\"子弹撞到了实体\")\r\n            if (this.gunData.weaponid == 1005 || this.gunData.weaponid === 1105) {\r\n                this._pbc.size = new cc.size(120, 120)\r\n                this._pbc.apply()\r\n            }\r\n            this._doFly = false\r\n        }\r\n    },\r\n});\r\n"]}