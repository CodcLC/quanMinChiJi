{"version":3,"sources":["assets\\scripts\\manager\\UIManager.js"],"names":["PREFAB_PATH","require","JSON_PATH","window","conMag","cc","Class","Component","properties","gameRoot","Node","uiRoot","popupRoot","toastRoot","toastPrefab","Prefab","loadingMask","loadingProgress","ProgressBar","splashUI","_Prefabs","_Jsons","mapCamera","Camera","mipmapCamera","normalSkinData","sp","SkeletonData","advanceSkinDataGroup","boxSkinDataGroup","commonAtlas","SpriteAtlas","gunSkinDataGroup","onLoad","GameApp","uiManager","node","destroy","game","addPersistRootNode","director","getCollisionManager","enabled","enabledDrawBoundingBox","enabledDebugDraw","manager","getPhysicsManager","debugDrawFlags","PhysicsManager","DrawBits","e_aabbBit","e_pairBit","e_centerOfMassBit","e_jointBit","e_shapeBit","frameSize","view","getFrameSize","canvas","width","devicePixelRatio","height","setLoadingMaskVisible","progress","startLoading","console","log","active","loadAll","completedCount","totalCount","per","isNaN","bind","userData","sys","localStorage","getItem","undefined","dataManager","JSON","parse","showUI","cbProgress","cbComplete","paths","ii","name","push","prefabCount","jj","name2","jsonCount","loader","loadResArray","err","prefabs","names","Object","keys","i","names2","j","json","jsonData","load","cb","loadRes","prefab","error","message","showGameObject","parentNode","instantiate","addChild","showGame","_curGameName","_curName","clearGames","children","forEach","eachUI","runAction","sequence","fadeOut","callFunc","clearPopups","opacity","fadeIn","getUI","getChildByName","popUI","uis","length","isInMapSight","_target","cameraWidth","cameraHeight","thePos","getWorldToScreenPoint","convertToWorldSpaceAR","v2","x","y","showPopup","clean","_curPopupName","scaleX","scaleY","scaleTo","easing","easeBounceOut","getPopup","popPopup","popups","closePopup","getGame","destroyAllChildren","showToast","s","callback","num","toast","childrenCount","moveUp","moveBy","getComponent","show","isShow","update","dt","globalData","onLineTime","recordState","RecordState","READY","recordTimer","RECORD","PAUSE"],"mappings":"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","sourceRoot":"/","sourcesContent":["const PREFAB_PATH = require('PrefabPath');\r\nconst JSON_PATH = require('JsonPath');\r\nwindow.conMag = window.conMag || require(\"ConfigManager\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        gameRoot: cc.Node,\r\n        uiRoot: cc.Node,\r\n        popupRoot: cc.Node,\r\n        toastRoot: cc.Node,\r\n        toastPrefab: cc.Prefab,\r\n        loadingMask: cc.Node,\r\n        loadingProgress: cc.ProgressBar,\r\n        splashUI: cc.Node,\r\n        _Prefabs: {\r\n            default: {},\r\n        },\r\n        _Jsons: {\r\n            default: {},\r\n        },\r\n\r\n        mapCamera: cc.Camera,\r\n        mipmapCamera: cc.Camera,\r\n        normalSkinData: sp.SkeletonData,\r\n        advanceSkinDataGroup: [sp.SkeletonData],\r\n        boxSkinDataGroup: [sp.SkeletonData],\r\n        commonAtlas: cc.SpriteAtlas,\r\n        gunSkinDataGroup: [sp.SkeletonData]\r\n    },\r\n\r\n    onLoad() {\r\n        if (GameApp.uiManager !== null) {\r\n            return this.node.destroy();\r\n        }\r\n        GameApp.uiManager = this;\r\n        cc.game.addPersistRootNode(this.node);\r\n\r\n        cc.director.getCollisionManager().enabled = true;\r\n        cc.director.getCollisionManager().enabledDrawBoundingBox = true;\r\n        cc.director.getCollisionManager().enabledDebugDraw = true;\r\n        var manager = cc.director.getPhysicsManager();\r\n        manager.enabled = true;\r\n        manager.debugDrawFlags = cc.PhysicsManager.DrawBits.e_aabbBit |\r\n            cc.PhysicsManager.DrawBits.e_pairBit |\r\n            cc.PhysicsManager.DrawBits.e_centerOfMassBit |\r\n            cc.PhysicsManager.DrawBits.e_jointBit |\r\n            cc.PhysicsManager.DrawBits.e_shapeBit;\r\n        let frameSize = cc.view.getFrameSize();\r\n        var canvas = cc.game.canvas;\r\n        canvas.width = frameSize.width * window.devicePixelRatio;\r\n        canvas.height = frameSize.height * window.devicePixelRatio;\r\n\r\n        this.setLoadingMaskVisible(false);\r\n        this.loadingProgress.progress = 0;\r\n        //开始加载;\r\n        this.startLoading();\r\n\r\n        // window.conMag.loadAllConfig(() => {\r\n        //     let all = window.conMag.getAllConfig()\r\n        //     // console.log(\"这是读取的数据\")\r\n        //     // console.log(all[\"Config\"])\r\n        //     var skinJson = all[\"Skin\"]\r\n        //     console.log(skinJson.json['skins'])\r\n        // })\r\n\r\n    },\r\n\r\n    startLoading: function () {\r\n        console.log('开始加载');\r\n        this.loadingProgress.node.active = true;\r\n        this.loadAll(function (completedCount, totalCount) {\r\n            let per = completedCount / totalCount;\r\n            if (per && !isNaN(per)) {\r\n                this.loadingProgress.progress = per\r\n            }\r\n        }.bind(this), function () {\r\n            this.loadingProgress.node.active = false;\r\n            this.splashUI.active = false;\r\n            //读取用户信息;\r\n            let userData = cc.sys.localStorage.getItem(\"EatChicken_UserData\");\r\n            if (userData == null || userData == undefined || userData == '') {\r\n            } else {\r\n                GameApp.dataManager.userData = JSON.parse(userData);\r\n                //console.log(GameApp.dataManager.userData);\r\n            }\r\n            this.showUI(\"LoginUI\")\r\n        }.bind(this))\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param cbProgress        加载中的回调\r\n     * @param cbComplete        加载完成的回调\r\n     */\r\n    loadAll(cbProgress, cbComplete) {\r\n        let paths = [];\r\n        var ii = 0;\r\n        //加载预制体配置路径文件;\r\n        for (let name in PREFAB_PATH) {\r\n            paths.push(PREFAB_PATH[name]);\r\n            ii++\r\n        }\r\n        var prefabCount = ii;\r\n        var jj = 0;\r\n        //加载JSON配置文件;\r\n        for (let name2 in JSON_PATH) {\r\n            paths.push(JSON_PATH[name2]);\r\n            jj++\r\n        }\r\n        let jsonCount = jj;\r\n        cc.loader.loadResArray(paths, function (completedCount, totalCount) {\r\n            // console.log(completedCount + '/' + totalCount)\r\n            cbProgress(completedCount, totalCount);\r\n        }, function (err, prefabs) {\r\n            let names = Object.keys(PREFAB_PATH);\r\n            //for (let i in prefabs) {\r\n            for (let i = 0; i < prefabCount; i++) {\r\n                this._Prefabs[names[i]] = prefabs[i];\r\n            }\r\n            let names2 = Object.keys(JSON_PATH);\r\n            //for (let i in prefabs) {\r\n            for (let j = 0; j < jsonCount; j++) {\r\n                this._Jsons[names2[j]] = prefabs[prefabCount + j].json[names2[j]];\r\n                GameApp.dataManager.jsonData[names2[j]] = this._Jsons[names2[j]]\r\n            }\r\n            // console.log(GameApp.dataManager.jsonData)\r\n            cbComplete();\r\n            // let paths2 = ['data/skins.json'];\r\n\r\n            // cc.loader.loadResArray(paths2, function (completedCount, totalCount) {\r\n            //     cbProgress(completedCount, totalCount);\r\n            // }, function (err, jsons) {\r\n            //     // console.log(jsons[0].json.skins)\r\n            //     GameApp.dataManager.skinsData = jsons[0].json.skins\r\n            //     console.log(GameApp.dataManager.skinsData)\r\n            //     cbComplete();\r\n            // }.bind(this))\r\n\r\n        }.bind(this));\r\n    },\r\n\r\n    load(name, cb) {\r\n        cc.loader.loadRes(PREFAB_PATH[name], function (err, prefab) {\r\n            if (err) {\r\n                cc.error(err.message || err);\r\n                return;\r\n            }\r\n            this._Prefabs[name] = prefab;\r\n            cb && cb(name);\r\n        }.bind(this));\r\n    },\r\n\r\n    showGameObject(name, cb, parentNode) {\r\n        if (!this._Prefabs[name]) {\r\n            this.load(name, function () {\r\n                this.showGameObject(name, cb);\r\n            }.bind(this));\r\n            return;\r\n        }\r\n\r\n        let node = cc.instantiate(this._Prefabs[name]);\r\n        parentNode && parentNode.addChild(node);\r\n        cb && cb(node);\r\n    },\r\n\r\n    showGame(name, cb) {\r\n        //未加载\r\n        if (this._curGameName == name) {\r\n            console.log(\"---showGame.repeat----\")\r\n            //允许刷新Game\r\n            // return;\r\n        }\r\n\r\n        if (!this._Prefabs[name]) {\r\n            this.load(name, function () {\r\n                this.showGame(name, cb);\r\n            }.bind(this));\r\n            return;\r\n        }\r\n\r\n        let node = cc.instantiate(this._Prefabs[name]);\r\n        this.gameRoot.addChild(node);\r\n        this._curGameName = name;\r\n\r\n        cb && cb(node);\r\n    },\r\n\r\n    showUI(name, cb) {\r\n        console.log('showUI');\r\n        //未加载\r\n        if (this._curName == name) {\r\n            console.log(\"---showUI.repeat----\")\r\n            //不允许刷新UI\r\n            return;\r\n        }\r\n\r\n        if (!this._Prefabs[name]) {\r\n            this.load(name, function () {\r\n                this.showUI(name, cb);\r\n            }.bind(this));\r\n            return;\r\n        }\r\n        //已加载 \r\n        // this.uiRoot.destroyAllChildren();\r\n        // this.clearPopups()\r\n        this.clearGames()\r\n        //特殊处理的UI\r\n        // for (let i = this.popupRoot.children.length - 1; i >= 0; i--) {\r\n        //     if (this.popupRoot.children[i]._tag !== 10086) {\r\n        //         this.popupRoot.children[i].destroy();\r\n        //     }\r\n        // }\r\n        this.uiRoot.children.forEach(eachUI => {\r\n            eachUI.runAction(cc.sequence(cc.fadeOut(0.1), cc.callFunc(() => {\r\n                eachUI.destroy()\r\n            })))\r\n        });\r\n        this.clearPopups();\r\n        let node = cc.instantiate(this._Prefabs[name]);\r\n        node.opacity = 0;\r\n        this.uiRoot.addChild(node);\r\n        node.runAction(cc.fadeIn(0.3));\r\n        this._curName = name;\r\n        cb && cb(node);\r\n    },\r\n\r\n    getUI(name) {\r\n        return this.uiRoot.getChildByName(name);\r\n    },\r\n\r\n    popUI() {\r\n        let uis = this.uiRoot.children;\r\n        if (uis.length > 0) {\r\n            uis[uis.length - 1].destroy();\r\n        }\r\n    },\r\n\r\n    isInMapSight(_target) {\r\n        var cameraWidth = this.mapCamera.node.width / 0.9\r\n        var cameraHeight = this.mapCamera.node.height / 0.9\r\n        var thePos = this.mapCamera.getWorldToScreenPoint(_target.convertToWorldSpaceAR(cc.v2(0, 0)))\r\n        if (thePos.x < 0 || thePos.x > cameraWidth || thePos.y < 0 || thePos.y > cameraHeight) {\r\n            return false\r\n        }\r\n        return true\r\n    },\r\n\r\n    // showTop(cb) {\r\n    //     var name = \"TopUI\"\r\n    //     //未加载\r\n    //     if (!this._Prefabs[name]) {\r\n    //         this.load(name, function () {\r\n    //             this.showTop(name, cb);\r\n    //         }.bind(this));\r\n    //         return;\r\n    //     }\r\n    //     //已加载\r\n    //     if (this.topRoot.childrenCount == 0) {\r\n    //         let node = cc.instantiate(this._Prefabs[name]);\r\n    //         this.topRoot.addChild(node);\r\n    //     } else {\r\n    //         this.topRoot.children[0].active = true\r\n    //     }\r\n\r\n    //     cb && cb(node);\r\n    // },\r\n\r\n    // getTop() {\r\n    //     return this.topRoot.children[0];\r\n    // },\r\n    // hideTop() {\r\n    //     (this.topRoot.childrenCount > 0) && (this.topRoot.children[0].active = false);\r\n    // },\r\n\r\n    showPopup(name, cb, clean = true) {\r\n        if (this._curPopupName == name) {\r\n            console.log(\"---showPopup.repeat----\")\r\n            //允许刷新popup\r\n            // return;\r\n        }\r\n        //未加载\r\n        if (!this._Prefabs[name]) {\r\n            this.load(name, function () {\r\n                this.showPopup(name, cb);\r\n            }.bind(this));\r\n            return;\r\n        }\r\n        if (clean) {\r\n            this.clearPopups()\r\n        }\r\n        //已加载\r\n        let node = cc.instantiate(this._Prefabs[name]);\r\n        // node.opacity = 0\r\n        node.children[0].scaleX = 0\r\n        node.children[0].scaleY = 0\r\n        this.popupRoot.addChild(node);\r\n        node.children[0].runAction(cc.scaleTo(0.5, 1).easing(cc.easeBounceOut(2)))\r\n        this._curPopupName = name\r\n\r\n        cb && cb(node);\r\n    },\r\n\r\n    getPopup(name) {\r\n        return this.popupRoot.getChildByName(name);\r\n    },\r\n\r\n    popPopup() {\r\n        let popups = this.popupRoot.children;\r\n        if (popups.length > 0) {\r\n            popups[popups.length - 1].destroy();\r\n        }\r\n    },\r\n\r\n    closePopup(name) {\r\n        for (let node of this.popupRoot.children) {\r\n            if (node.name === name) {\r\n                node.runAction(cc.sequence(cc.fadeOut(0.1), cc.callFunc(() => {\r\n                    this._curPopupName = \"\"\r\n                    node.active = false;\r\n                    node.destroy();\r\n                })));\r\n                break;\r\n            }\r\n        }\r\n    },\r\n\r\n    clearPopups() {\r\n        console.log('clearPopups')\r\n        for (let node of this.popupRoot.children) {\r\n            node.runAction(cc.sequence(cc.fadeOut(0.1), cc.callFunc(() => {\r\n                node.destroy();\r\n            })))\r\n        }\r\n        this._curPopupName = \"\"\r\n        // this.popupRoot.destroyAllChildren();\r\n    },\r\n\r\n    getGame(name) {\r\n        return this.gameRoot.getChildByName(name);\r\n    },\r\n\r\n    clearGames() {\r\n        this.gameRoot.destroyAllChildren();\r\n        this._curGameName = \"\"\r\n    },\r\n\r\n    showToast(s, callback, num) {\r\n        if (!this.toastPrefab) return;\r\n        var toast = cc.instantiate(this.toastPrefab);\r\n        if (this.toastRoot.childrenCount > 0) {\r\n            for (var i = this.toastRoot.childrenCount - 1; i >= 0; i--) {\r\n                var moveUp = cc.moveBy(0.1, cc.v2(0, toast.height))\r\n                this.toastRoot.children[i].runAction(moveUp)\r\n            }\r\n        }\r\n        this.toastRoot.addChild(toast);\r\n        toast.getComponent('ToastUI').show(s, callback, num);\r\n    },\r\n\r\n    setLoadingMaskVisible(isShow) {\r\n        if (isShow) {\r\n            this.loadingMask.active = true\r\n        } else {\r\n            this.loadingMask.active = false\r\n        }\r\n    },\r\n\r\n    //例外\r\n    update(dt) {\r\n        GameApp.dataManager.globalData.onLineTime += dt;\r\n        switch (GameApp.dataManager.globalData.recordState) {\r\n            case RecordState.READY:\r\n                GameApp.dataManager.globalData.recordTimer = 0;\r\n                break;\r\n            case RecordState.RECORD:\r\n                GameApp.dataManager.globalData.recordTimer += dt;\r\n                break;\r\n            case RecordState.PAUSE:\r\n                break;\r\n        }\r\n    }\r\n\r\n});"]}