
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/ui/PrepareMap.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'f0242hMp5pE/YgD+xqZxRob', 'PrepareMap');
// scripts/ui/PrepareMap.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    tiledMap: cc.TiledMap,
    objectPrefab: cc.Prefab,
    colliderPrefab: cc.Prefab,
    groundItemPrefab: cc.Prefab,
    waitLabel: cc.Node,
    allObjectNode: cc.Node,
    allColliderNode: cc.Node,
    allGunNode: cc.Node,
    enemySpawnPosGroupNode: cc.Node,
    mapAtlas: cc.SpriteAtlas,
    _timer0: 0.1,
    _timer: 0.1,
    readyToSort: false
  },
  onLoad: function onLoad() {
    this.initMapShow();
    this.showPlayer();
    this.showEnemy();
  },
  update: function update(dt) {
    if (!this.readyToSort) return;
    this._timer -= dt;

    if (this._timer < 0) {
      this._timer = this._timer0;
      this.sortAll();
    }
  },
  initMapShow: function initMapShow() {
    var _this = this;

    GameApp.dataManager.globalData.allRoleArr = [];
    GameApp.dataManager.globalData.allGunArr = []; // this.node.children[2].active = true

    var wallLayer = this.tiledMap.getLayer("wall");

    this.tiledMap.getObjectGroup("dynamic")._objects.forEach(function (element) {
      var obj = cc.instantiate(_this.objectPrefab);
      obj.getComponent(cc.Sprite).spriteFrame = _this.mapAtlas.getSpriteFrame(element.name.split('.')[0]);
      obj.parent = _this.allColliderNode;
      var desPos = wallLayer.getPositionAt(_this.getTilePos(cc.v2(element.x, element.y)));
      obj.setPosition(desPos);

      var ddd = _this.allObjectNode.convertToNodeSpaceAR(obj.convertToWorldSpaceAR(cc.v2(0, 0)));

      obj.parent = _this.allObjectNode;
      obj.setPosition(ddd);
    });

    this.tiledMap.getObjectGroup("collision")._objects.forEach(function (element) {
      var obj = cc.instantiate(_this.colliderPrefab);
      var coli = obj.getComponent(cc.PhysicsBoxCollider);
      coli.size = cc.size(element.width, element.height);
      coli.offset = cc.v2(element.width / 2, -element.height / 2);
      coli.apply();

      _this.allColliderNode.addChild(obj);

      obj.setPosition(cc.v2(element.x, element.y));
      coli.tag = Tags.collider;
    });

    this.tiledMap.getObjectGroup("gun")._objects.forEach(function (element) {
      // var element = this.tiledMap.getObjectGroup("gun")._objects[0]
      var obj = cc.instantiate(_this.groundItemPrefab);
      obj.parent = _this.allColliderNode;
      var desPos = wallLayer.getPositionAt(_this.getTilePos(cc.v2(element.x, element.y)));
      obj.setPosition(desPos);

      var ddd = _this.allGunNode.convertToNodeSpaceAR(obj.convertToWorldSpaceAR(cc.v2(0, 0)));

      obj.parent = _this.allGunNode;
      obj.setPosition(ddd);
      var _param = {
        _type: ItemType.weapon,
        _kind: Tools.randomNum(0, 5)
      };
      obj.getComponent('GroundItem').init(_param);
      GameApp.dataManager.globalData.allGunArr.push(obj);
    });
  },
  //将像素坐标转化为瓦片坐标，posInPixel：目标节点的position
  getTilePos: function getTilePos(posInPixel) {
    var mapSize = this.tiledMap.node.getContentSize();
    var tileSize = this.tiledMap.getTileSize();
    var x = Math.floor(posInPixel.x / tileSize.width);
    var y = Math.floor((mapSize.height - posInPixel.y) / tileSize.height);
    return cc.v2(x, y);
  },
  showPlayer: function showPlayer() {
    var _this2 = this;

    GameApp.uiManager.showGameObject('Player', function (node) {
      // GameApp.dataManager.globalData.allRoleArr.push(node)
      // node.setPosition(0, 0)
      var c = node.getComponent("Player");
      GameApp.uiManager.getUI("PrepareUI").getComponent("PrepareUI").joystick.getComponent("Joystick").player = c;
      c.init();
      GameApp.dataManager.globalData.allRoleArr.push(c);
      _this2.readyToSort = true;
    }, this.allObjectNode);
  },
  showEnemy: function showEnemy() {
    var tempPosArr = [];
    var standardArr = this.enemySpawnPosGroupNode.children; // var xRangeArr = []
    // var eachSpaceX = (standardArr[1].x - standardArr[0].x) / 6
    // for (let i = 0; i < 7; i++) {
    //     xRangeArr.push(standardArr[0].x + eachSpaceX * i)
    // }
    // var yRangeArr = []
    // var eachSpaceY = (standardArr[2].y - standardArr[0].y) / 5
    // for (let i = 0; i < 6; i++) {
    //     yRangeArr.push(standardArr[0].y + eachSpaceY * i)
    // }
    // for (let i = 0; i < xRangeArr.length; i++) {
    //     for (let j = 0; j < yRangeArr.length; j++) {
    //         tempPosArr.push(cc.v2(xRangeArr[i], yRangeArr[j]))
    //     }
    // }
    // tempPosArr = Tools.getRandomAmountElementUnRepeat(tempPosArr, 30)

    var tagNum = Tags.enemy;

    for (var i = 0; i < 5; i++) {
      if (i + 1 == GameApp.dataManager.userData.choosedSkinId) {
        continue;
      }

      GameApp.uiManager.showGameObject('Enemy', function (node) {
        // GameApp.dataManager.globalData.allRoleArr.push(node)
        node.getComponent(cc.PhysicsBoxCollider).tag = tagNum++;
        node.setPosition(cc.v2(Tools.randomNum(standardArr[0].x, standardArr[1].x), Tools.randomNum(standardArr[2].y, standardArr[0].y)));
        var c = node.getComponent("Enemy");
        c.init(i + 1, GameApp.dataManager.jsonData.RobotName[i]);
        GameApp.dataManager.globalData.allRoleArr.push(c);
      }, this.allObjectNode);
    } // var index = 0


    var func = function () {
      if (i == 30) return;

      if (i + 1 == GameApp.dataManager.userData.choosedSkinId) {} else {
        GameApp.uiManager.showGameObject('Enemy', function (node) {
          // GameApp.dataManager.globalData.allRoleArr.push(node)
          node.getComponent(cc.PhysicsBoxCollider).tag = tagNum++;
          node.setPosition(cc.v2(Tools.randomNum(standardArr[0].x, standardArr[1].x), Tools.randomNum(standardArr[2].y, standardArr[0].y)));
          var c = node.getComponent("Enemy");
          c.init(i + 1, GameApp.dataManager.jsonData.RobotName[i]);
          GameApp.dataManager.globalData.allRoleArr.push(c);
          GameApp.eventManager.emit(EventNames.EVENT_SHOW_ALLROLENUM_UI);
        }, this.allObjectNode);
      }

      i++;
    }.bind(this);

    this.schedule(func, 0.5, 25, 0); // 0.5
  },
  sortAll: function sortAll() {
    var cloneObjArr = this.allObjectNode.children.concat();
    var tempDict = [];
    var tempIndex = [];

    for (var i in cloneObjArr) {
      if (GameApp.uiManager.isInMapSight(cloneObjArr[i])) {
        tempDict.push({
          y: cloneObjArr[i].y,
          index: i
        });
        tempIndex.push(i);
      }
    } // console.log(tempDict)


    tempDict.sort(function (a, b) {
      return b.y - a.y;
    });

    for (var _i in tempDict) {
      cloneObjArr[tempDict[_i].index].setSiblingIndex(tempIndex[_i]);
    } // console.log(tempDict)
    // console.log(this.allObjectNode.children)

  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcdWlcXFByZXBhcmVNYXAuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJ0aWxlZE1hcCIsIlRpbGVkTWFwIiwib2JqZWN0UHJlZmFiIiwiUHJlZmFiIiwiY29sbGlkZXJQcmVmYWIiLCJncm91bmRJdGVtUHJlZmFiIiwid2FpdExhYmVsIiwiTm9kZSIsImFsbE9iamVjdE5vZGUiLCJhbGxDb2xsaWRlck5vZGUiLCJhbGxHdW5Ob2RlIiwiZW5lbXlTcGF3blBvc0dyb3VwTm9kZSIsIm1hcEF0bGFzIiwiU3ByaXRlQXRsYXMiLCJfdGltZXIwIiwiX3RpbWVyIiwicmVhZHlUb1NvcnQiLCJvbkxvYWQiLCJpbml0TWFwU2hvdyIsInNob3dQbGF5ZXIiLCJzaG93RW5lbXkiLCJ1cGRhdGUiLCJkdCIsInNvcnRBbGwiLCJHYW1lQXBwIiwiZGF0YU1hbmFnZXIiLCJnbG9iYWxEYXRhIiwiYWxsUm9sZUFyciIsImFsbEd1bkFyciIsIndhbGxMYXllciIsImdldExheWVyIiwiZ2V0T2JqZWN0R3JvdXAiLCJfb2JqZWN0cyIsImZvckVhY2giLCJlbGVtZW50Iiwib2JqIiwiaW5zdGFudGlhdGUiLCJnZXRDb21wb25lbnQiLCJTcHJpdGUiLCJzcHJpdGVGcmFtZSIsImdldFNwcml0ZUZyYW1lIiwibmFtZSIsInNwbGl0IiwicGFyZW50IiwiZGVzUG9zIiwiZ2V0UG9zaXRpb25BdCIsImdldFRpbGVQb3MiLCJ2MiIsIngiLCJ5Iiwic2V0UG9zaXRpb24iLCJkZGQiLCJjb252ZXJ0VG9Ob2RlU3BhY2VBUiIsImNvbnZlcnRUb1dvcmxkU3BhY2VBUiIsImNvbGkiLCJQaHlzaWNzQm94Q29sbGlkZXIiLCJzaXplIiwid2lkdGgiLCJoZWlnaHQiLCJvZmZzZXQiLCJhcHBseSIsImFkZENoaWxkIiwidGFnIiwiVGFncyIsImNvbGxpZGVyIiwiX3BhcmFtIiwiX3R5cGUiLCJJdGVtVHlwZSIsIndlYXBvbiIsIl9raW5kIiwiVG9vbHMiLCJyYW5kb21OdW0iLCJpbml0IiwicHVzaCIsInBvc0luUGl4ZWwiLCJtYXBTaXplIiwibm9kZSIsImdldENvbnRlbnRTaXplIiwidGlsZVNpemUiLCJnZXRUaWxlU2l6ZSIsIk1hdGgiLCJmbG9vciIsInVpTWFuYWdlciIsInNob3dHYW1lT2JqZWN0IiwiYyIsImdldFVJIiwiam95c3RpY2siLCJwbGF5ZXIiLCJ0ZW1wUG9zQXJyIiwic3RhbmRhcmRBcnIiLCJjaGlsZHJlbiIsInRhZ051bSIsImVuZW15IiwiaSIsInVzZXJEYXRhIiwiY2hvb3NlZFNraW5JZCIsImpzb25EYXRhIiwiUm9ib3ROYW1lIiwiZnVuYyIsImV2ZW50TWFuYWdlciIsImVtaXQiLCJFdmVudE5hbWVzIiwiRVZFTlRfU0hPV19BTExST0xFTlVNX1VJIiwiYmluZCIsInNjaGVkdWxlIiwiY2xvbmVPYmpBcnIiLCJjb25jYXQiLCJ0ZW1wRGljdCIsInRlbXBJbmRleCIsImlzSW5NYXBTaWdodCIsImluZGV4Iiwic29ydCIsImEiLCJiIiwic2V0U2libGluZ0luZGV4Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUNBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUsQ0FBQ0UsU0FEUDtBQUdMQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsUUFBUSxFQUFFSixFQUFFLENBQUNLLFFBREw7QUFFUkMsSUFBQUEsWUFBWSxFQUFFTixFQUFFLENBQUNPLE1BRlQ7QUFHUkMsSUFBQUEsY0FBYyxFQUFFUixFQUFFLENBQUNPLE1BSFg7QUFJUkUsSUFBQUEsZ0JBQWdCLEVBQUVULEVBQUUsQ0FBQ08sTUFKYjtBQU1SRyxJQUFBQSxTQUFTLEVBQUVWLEVBQUUsQ0FBQ1csSUFOTjtBQU9SQyxJQUFBQSxhQUFhLEVBQUVaLEVBQUUsQ0FBQ1csSUFQVjtBQVFSRSxJQUFBQSxlQUFlLEVBQUViLEVBQUUsQ0FBQ1csSUFSWjtBQVNSRyxJQUFBQSxVQUFVLEVBQUVkLEVBQUUs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c291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJcclxuY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICB0aWxlZE1hcDogY2MuVGlsZWRNYXAsXHJcbiAgICAgICAgb2JqZWN0UHJlZmFiOiBjYy5QcmVmYWIsXHJcbiAgICAgICAgY29sbGlkZXJQcmVmYWI6IGNjLlByZWZhYixcclxuICAgICAgICBncm91bmRJdGVtUHJlZmFiOiBjYy5QcmVmYWIsXHJcblxyXG4gICAgICAgIHdhaXRMYWJlbDogY2MuTm9kZSxcclxuICAgICAgICBhbGxPYmplY3ROb2RlOiBjYy5Ob2RlLFxyXG4gICAgICAgIGFsbENvbGxpZGVyTm9kZTogY2MuTm9kZSxcclxuICAgICAgICBhbGxHdW5Ob2RlOiBjYy5Ob2RlLFxyXG4gICAgICAgIGVuZW15U3Bhd25Qb3NHcm91cE5vZGU6IGNjLk5vZGUsXHJcblxyXG4gICAgICAgIG1hcEF0bGFzOiBjYy5TcHJpdGVBdGxhcyxcclxuXHJcbiAgICAgICAgX3RpbWVyMDogMC4xLFxyXG4gICAgICAgIF90aW1lcjogMC4xLFxyXG4gICAgICAgIHJlYWR5VG9Tb3J0OiBmYWxzZVxyXG4gICAgfSxcclxuXHJcblxyXG4gICAgb25Mb2FkKCkge1xyXG4gICAgICAgIHRoaXMuaW5pdE1hcFNob3coKVxyXG4gICAgICAgIHRoaXMuc2hvd1BsYXllcigpXHJcbiAgICAgICAgdGhpcy5zaG93RW5lbXkoKVxyXG4gICAgfSxcclxuICAgIHVwZGF0ZShkdCkge1xyXG4gICAgICAgIGlmICghdGhpcy5yZWFkeVRvU29ydCkgcmV0dXJuO1xyXG4gICAgICAgIHRoaXMuX3RpbWVyIC09IGR0XHJcbiAgICAgICAgaWYgKHRoaXMuX3RpbWVyIDwgMCkge1xyXG4gICAgICAgICAgICB0aGlzLl90aW1lciA9IHRoaXMuX3RpbWVyMFxyXG4gICAgICAgICAgICB0aGlzLnNvcnRBbGwoKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9LFxyXG4gICAgaW5pdE1hcFNob3coKSB7XHJcbiAgICAgICAgR2FtZUFwcC5kYXRhTWFuYWdlci5nbG9iYWxEYXRhLmFsbFJvbGVBcnIgPSBbXVxyXG4gICAgICAgIEdhbWVBcHAuZGF0YU1hbmFnZXIuZ2xvYmFsRGF0YS5hbGxHdW5BcnIgPSBbXVxyXG4gICAgICAgIC8vIHRoaXMubm9kZS5jaGlsZHJlblsyXS5hY3RpdmUgPSB0cnVlXHJcbiAgICAgICAgbGV0IHdhbGxMYXllciA9IHRoaXMudGlsZWRNYXAuZ2V0TGF5ZXIoXCJ3YWxsXCIpXHJcbiAgICAgICAgdGhpcy50aWxlZE1hcC5nZXRPYmplY3RHcm91cChcImR5bmFtaWNcIikuX29iamVjdHMuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgbGV0IG9iaiA9IGNjLmluc3RhbnRpYXRlKHRoaXMub2JqZWN0UHJlZmFiKVxyXG4gICAgICAgICAgICBvYmouZ2V0Q29tcG9uZW50KGNjLlNwcml0ZSkuc3ByaXRlRnJhbWUgPSB0aGlzLm1hcEF0bGFzLmdldFNwcml0ZUZyYW1lKGVsZW1lbnQubmFtZS5zcGxpdCgnLicpWzBdKVxyXG4gICAgICAgICAgICBvYmoucGFyZW50ID0gdGhpcy5hbGxDb2xsaWRlck5vZGVcclxuICAgICAgICAgICAgbGV0IGRlc1BvcyA9IHdhbGxMYXllci5nZXRQb3NpdGlvbkF0KHRoaXMuZ2V0VGlsZVBvcyhjYy52MihlbGVtZW50LngsIGVsZW1lbnQueSkpKVxyXG4gICAgICAgICAgICBvYmouc2V0UG9zaXRpb24oZGVzUG9zKVxyXG4gICAgICAgICAgICBsZXQgZGRkID0gdGhpcy5hbGxPYmplY3ROb2RlLmNvbnZlcnRUb05vZGVTcGFjZUFSKG9iai5jb252ZXJ0VG9Xb3JsZFNwYWNlQVIoY2MudjIoMCwgMCkpKVxyXG4gICAgICAgICAgICBvYmoucGFyZW50ID0gdGhpcy5hbGxPYmplY3ROb2RlXHJcbiAgICAgICAgICAgIG9iai5zZXRQb3NpdGlvbihkZGQpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy50aWxlZE1hcC5nZXRPYmplY3RHcm91cChcImNvbGxpc2lvblwiKS5fb2JqZWN0cy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICBsZXQgb2JqID0gY2MuaW5zdGFudGlhdGUodGhpcy5jb2xsaWRlclByZWZhYilcclxuICAgICAgICAgICAgbGV0IGNvbGkgPSBvYmouZ2V0Q29tcG9uZW50KGNjLlBoeXNpY3NCb3hDb2xsaWRlcilcclxuICAgICAgICAgICAgY29saS5zaXplID0gY2Muc2l6ZShlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodClcclxuICAgICAgICAgICAgY29saS5vZmZzZXQgPSBjYy52MihlbGVtZW50LndpZHRoIC8gMiwgLWVsZW1lbnQuaGVpZ2h0IC8gMilcclxuICAgICAgICAgICAgY29saS5hcHBseSgpXHJcbiAgICAgICAgICAgIHRoaXMuYWxsQ29sbGlkZXJOb2RlLmFkZENoaWxkKG9iailcclxuICAgICAgICAgICAgb2JqLnNldFBvc2l0aW9uKGNjLnYyKGVsZW1lbnQueCwgZWxlbWVudC55KSlcclxuICAgICAgICAgICAgY29saS50YWcgPSBUYWdzLmNvbGxpZGVyXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy50aWxlZE1hcC5nZXRPYmplY3RHcm91cChcImd1blwiKS5fb2JqZWN0cy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICAvLyB2YXIgZWxlbWVudCA9IHRoaXMudGlsZWRNYXAuZ2V0T2JqZWN0R3JvdXAoXCJndW5cIikuX29iamVjdHNbMF1cclxuICAgICAgICAgICAgbGV0IG9iaiA9IGNjLmluc3RhbnRpYXRlKHRoaXMuZ3JvdW5kSXRlbVByZWZhYilcclxuICAgICAgICAgICAgb2JqLnBhcmVudCA9IHRoaXMuYWxsQ29sbGlkZXJOb2RlXHJcbiAgICAgICAgICAgIGxldCBkZXNQb3MgPSB3YWxsTGF5ZXIuZ2V0UG9zaXRpb25BdCh0aGlzLmdldFRpbGVQb3MoY2MudjIoZWxlbWVudC54LCBlbGVtZW50LnkpKSlcclxuICAgICAgICAgICAgb2JqLnNldFBvc2l0aW9uKGRlc1BvcylcclxuICAgICAgICAgICAgbGV0IGRkZCA9IHRoaXMuYWxsR3VuTm9kZS5jb252ZXJ0VG9Ob2RlU3BhY2VBUihvYmouY29udmVydFRvV29ybGRTcGFjZUFSKGNjLnYyKDAsIDApKSlcclxuICAgICAgICAgICAgb2JqLnBhcmVudCA9IHRoaXMuYWxsR3VuTm9kZVxyXG4gICAgICAgICAgICBvYmouc2V0UG9zaXRpb24oZGRkKVxyXG4gICAgICAgICAgICBsZXQgX3BhcmFtID0ge1xyXG4gICAgICAgICAgICAgICAgX3R5cGU6IEl0ZW1UeXBlLndlYXBvbixcclxuICAgICAgICAgICAgICAgIF9raW5kOiBUb29scy5yYW5kb21OdW0oMCwgNSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvYmouZ2V0Q29tcG9uZW50KCdHcm91bmRJdGVtJykuaW5pdChfcGFyYW0pXHJcbiAgICAgICAgICAgIEdhbWVBcHAuZGF0YU1hbmFnZXIuZ2xvYmFsRGF0YS5hbGxHdW5BcnIucHVzaChvYmopXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSxcclxuICAgIC8v5bCG5YOP57Sg5Z2Q5qCH6L2s5YyW5Li655Om54mH5Z2Q5qCH77yMcG9zSW5QaXhlbO+8muebruagh+iKgueCueeahHBvc2l0aW9uXHJcbiAgICBnZXRUaWxlUG9zKHBvc0luUGl4ZWwpIHtcclxuICAgICAgICB2YXIgbWFwU2l6ZSA9IHRoaXMudGlsZWRNYXAubm9kZS5nZXRDb250ZW50U2l6ZSgpO1xyXG4gICAgICAgIHZhciB0aWxlU2l6ZSA9IHRoaXMudGlsZWRNYXAuZ2V0VGlsZVNpemUoKTtcclxuICAgICAgICB2YXIgeCA9IE1hdGguZmxvb3IocG9zSW5QaXhlbC54IC8gdGlsZVNpemUud2lkdGgpO1xyXG4gICAgICAgIHZhciB5ID0gTWF0aC5mbG9vcigobWFwU2l6ZS5oZWlnaHQgLSBwb3NJblBpeGVsLnkpIC8gdGlsZVNpemUuaGVpZ2h0KTtcclxuICAgICAgICByZXR1cm4gY2MudjIoeCwgeSk7XHJcbiAgICB9LFxyXG4gICAgc2hvd1BsYXllcigpIHtcclxuICAgICAgICBHYW1lQXBwLnVpTWFuYWdlci5zaG93R2FtZU9iamVjdCgnUGxheWVyJywgKG5vZGUpID0+IHtcclxuICAgICAgICAgICAgLy8gR2FtZUFwcC5kYXRhTWFuYWdlci5nbG9iYWxEYXRhLmFsbFJvbGVBcnIucHVzaChub2RlKVxyXG4gICAgICAgICAgICAvLyBub2RlLnNldFBvc2l0aW9uKDAsIDApXHJcbiAgICAgICAgICAgIHZhciBjID0gbm9kZS5nZXRDb21wb25lbnQoXCJQbGF5ZXJcIilcclxuICAgICAgICAgICAgR2FtZUFwcC51aU1hbmFnZXIuZ2V0VUkoXCJQcmVwYXJlVUlcIikuZ2V0Q29tcG9uZW50KFwiUHJlcGFyZVVJXCIpLmpveXN0aWNrLmdldENvbXBvbmVudChcIkpveXN0aWNrXCIpLnBsYXllciA9IGNcclxuICAgICAgICAgICAgYy5pbml0KClcclxuICAgICAgICAgICAgR2FtZUFwcC5kYXRhTWFuYWdlci5nbG9iYWxEYXRhLmFsbFJvbGVBcnIucHVzaChjKVxyXG4gICAgICAgICAgICB0aGlzLnJlYWR5VG9Tb3J0ID0gdHJ1ZVxyXG4gICAgICAgIH0sIHRoaXMuYWxsT2JqZWN0Tm9kZSlcclxuICAgIH0sXHJcbiAgICBzaG93RW5lbXkoKSB7XHJcbiAgICAgICAgdmFyIHRlbXBQb3NBcnIgPSBbXVxyXG4gICAgICAgIHZhciBzdGFuZGFyZEFyciA9IHRoaXMuZW5lbXlTcGF3blBvc0dyb3VwTm9kZS5jaGlsZHJlblxyXG4gICAgICAgIC8vIHZhciB4UmFuZ2VBcnIgPSBbXVxyXG4gICAgICAgIC8vIHZhciBlYWNoU3BhY2VYID0gKHN0YW5kYXJkQXJyWzFdLnggLSBzdGFuZGFyZEFyclswXS54KSAvIDZcclxuICAgICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IDc7IGkrKykge1xyXG4gICAgICAgIC8vICAgICB4UmFuZ2VBcnIucHVzaChzdGFuZGFyZEFyclswXS54ICsgZWFjaFNwYWNlWCAqIGkpXHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vIHZhciB5UmFuZ2VBcnIgPSBbXVxyXG4gICAgICAgIC8vIHZhciBlYWNoU3BhY2VZID0gKHN0YW5kYXJkQXJyWzJdLnkgLSBzdGFuZGFyZEFyclswXS55KSAvIDVcclxuICAgICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IDY7IGkrKykge1xyXG4gICAgICAgIC8vICAgICB5UmFuZ2VBcnIucHVzaChzdGFuZGFyZEFyclswXS55ICsgZWFjaFNwYWNlWSAqIGkpXHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vIGZvciAobGV0IGkgPSAwOyBpIDwgeFJhbmdlQXJyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgLy8gICAgIGZvciAobGV0IGogPSAwOyBqIDwgeVJhbmdlQXJyLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgLy8gICAgICAgICB0ZW1wUG9zQXJyLnB1c2goY2MudjIoeFJhbmdlQXJyW2ldLCB5UmFuZ2VBcnJbal0pKVxyXG4gICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICAvLyB0ZW1wUG9zQXJyID0gVG9vbHMuZ2V0UmFuZG9tQW1vdW50RWxlbWVudFVuUmVwZWF0KHRlbXBQb3NBcnIsIDMwKVxyXG4gICAgICAgIHZhciB0YWdOdW0gPSBUYWdzLmVuZW15XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGkgKyAxID09IEdhbWVBcHAuZGF0YU1hbmFnZXIudXNlckRhdGEuY2hvb3NlZFNraW5JZCkge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgR2FtZUFwcC51aU1hbmFnZXIuc2hvd0dhbWVPYmplY3QoJ0VuZW15JywgKG5vZGUpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIEdhbWVBcHAuZGF0YU1hbmFnZXIuZ2xvYmFsRGF0YS5hbGxSb2xlQXJyLnB1c2gobm9kZSlcclxuICAgICAgICAgICAgICAgIG5vZGUuZ2V0Q29tcG9uZW50KGNjLlBoeXNpY3NCb3hDb2xsaWRlcikudGFnID0gdGFnTnVtKytcclxuICAgICAgICAgICAgICAgIG5vZGUuc2V0UG9zaXRpb24oY2MudjIoVG9vbHMucmFuZG9tTnVtKHN0YW5kYXJkQXJyWzBdLngsIHN0YW5kYXJkQXJyWzFdLngpLCBUb29scy5yYW5kb21OdW0oc3RhbmRhcmRBcnJbMl0ueSwgc3RhbmRhcmRBcnJbMF0ueSkpKVxyXG4gICAgICAgICAgICAgICAgdmFyIGMgPSBub2RlLmdldENvbXBvbmVudChcIkVuZW15XCIpXHJcbiAgICAgICAgICAgICAgICBjLmluaXQoaSArIDEsIEdhbWVBcHAuZGF0YU1hbmFnZXIuanNvbkRhdGEuUm9ib3ROYW1lW2ldKVxyXG4gICAgICAgICAgICAgICAgR2FtZUFwcC5kYXRhTWFuYWdlci5nbG9iYWxEYXRhLmFsbFJvbGVBcnIucHVzaChjKVxyXG4gICAgICAgICAgICB9LCB0aGlzLmFsbE9iamVjdE5vZGUpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHZhciBpbmRleCA9IDBcclxuICAgICAgICB2YXIgZnVuYyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKGkgPT0gMzApIHJldHVyblxyXG4gICAgICAgICAgICBpZiAoaSArIDEgPT0gR2FtZUFwcC5kYXRhTWFuYWdlci51c2VyRGF0YS5jaG9vc2VkU2tpbklkKSB7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgR2FtZUFwcC51aU1hbmFnZXIuc2hvd0dhbWVPYmplY3QoJ0VuZW15JywgKG5vZGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBHYW1lQXBwLmRhdGFNYW5hZ2VyLmdsb2JhbERhdGEuYWxsUm9sZUFyci5wdXNoKG5vZGUpXHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5nZXRDb21wb25lbnQoY2MuUGh5c2ljc0JveENvbGxpZGVyKS50YWcgPSB0YWdOdW0rK1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuc2V0UG9zaXRpb24oY2MudjIoVG9vbHMucmFuZG9tTnVtKHN0YW5kYXJkQXJyWzBdLngsIHN0YW5kYXJkQXJyWzFdLngpLCBUb29scy5yYW5kb21OdW0oc3RhbmRhcmRBcnJbMl0ueSwgc3RhbmRhcmRBcnJbMF0ueSkpKVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjID0gbm9kZS5nZXRDb21wb25lbnQoXCJFbmVteVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIGMuaW5pdChpICsgMSwgR2FtZUFwcC5kYXRhTWFuYWdlci5qc29uRGF0YS5Sb2JvdE5hbWVbaV0pXHJcbiAgICAgICAgICAgICAgICAgICAgR2FtZUFwcC5kYXRhTWFuYWdlci5nbG9iYWxEYXRhLmFsbFJvbGVBcnIucHVzaChjKVxyXG4gICAgICAgICAgICAgICAgICAgIEdhbWVBcHAuZXZlbnRNYW5hZ2VyLmVtaXQoRXZlbnROYW1lcy5FVkVOVF9TSE9XX0FMTFJPTEVOVU1fVUkpXHJcbiAgICAgICAgICAgICAgICB9LCB0aGlzLmFsbE9iamVjdE5vZGUpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaSsrXHJcbiAgICAgICAgfS5iaW5kKHRoaXMpXHJcbiAgICAgICAgdGhpcy5zY2hlZHVsZShmdW5jLCAwLjUsIDI1LCAwKSAvLyAwLjVcclxuICAgIH0sXHJcbiAgICBzb3J0QWxsKCkge1xyXG4gICAgICAgIHZhciBjbG9uZU9iakFyciA9IHRoaXMuYWxsT2JqZWN0Tm9kZS5jaGlsZHJlbi5jb25jYXQoKVxyXG4gICAgICAgIHZhciB0ZW1wRGljdCA9IFtdXHJcbiAgICAgICAgdmFyIHRlbXBJbmRleCA9IFtdXHJcbiAgICAgICAgZm9yIChsZXQgaSBpbiBjbG9uZU9iakFycikge1xyXG4gICAgICAgICAgICBpZiAoR2FtZUFwcC51aU1hbmFnZXIuaXNJbk1hcFNpZ2h0KGNsb25lT2JqQXJyW2ldKSkge1xyXG4gICAgICAgICAgICAgICAgdGVtcERpY3QucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgeTogY2xvbmVPYmpBcnJbaV0ueSxcclxuICAgICAgICAgICAgICAgICAgICBpbmRleDogaVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIHRlbXBJbmRleC5wdXNoKGkpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2codGVtcERpY3QpXHJcbiAgICAgICAgdGVtcERpY3Quc29ydCgoYSwgYikgPT4gYi55IC0gYS55KVxyXG4gICAgICAgIGZvciAobGV0IGkgaW4gdGVtcERpY3QpIHtcclxuICAgICAgICAgICAgY2xvbmVPYmpBcnJbdGVtcERpY3RbaV0uaW5kZXhdLnNldFNpYmxpbmdJbmRleCh0ZW1wSW5kZXhbaV0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHRlbXBEaWN0KVxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuYWxsT2JqZWN0Tm9kZS5jaGlsZHJlbilcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuIl19