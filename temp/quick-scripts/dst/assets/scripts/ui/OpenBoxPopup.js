
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/ui/OpenBoxPopup.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '9a84fG3r59NkL5igHRQlhjW', 'OpenBoxPopup');
// scripts/ui/OpenBoxPopup.js

"use strict";

var Utils = require("Utils");

cc.Class({
  "extends": cc.Component,
  properties: {
    boxAnim: sp.Skeleton,
    delayShowPanel: cc.Node,
    //children 0是图，1是字
    _itemType: 1,
    _itemNum: 0,
    _pieceIndex: 0,
    onceClick: {
      "default": true,
      visible: false
    }
  },
  onLoad: function onLoad() {},
  init: function init(_skinData, _type, _num, _pieceIndex) {
    this._itemType = _type;
    this._itemNum = _num;
    this._pieceIndex = _pieceIndex;

    switch (_type) {
      case 1:
        this.addCoin(_num);
        break;

      case 2:
        this.addPiece(_num, _pieceIndex);
        break;
    }

    this.initSkinShow(_skinData);
  },
  initSkinShow: function initSkinShow(_skinData) {
    var _this = this;

    this.boxAnim.skeletonData = _skinData;
    var arr = ['appear', 'big--small', 'open', 'open_await']; //, 'last_open_await'

    var i = 0;
    this.boxAnim.setAnimation(0, arr[i++], false);
    this.boxAnim.setCompleteListener(function () {
      if (i > arr.length - 1) return;
      var loop = i == arr.length - 1;

      if (i == arr.length - 2) {
        _this.node.runAction(cc.sequence(cc.delayTime(0.8), cc.callFunc(function () {
          _this.delayShowPanel.active = true;
          Tools.scaleUpAndDowm(_this.delayShowPanel.children[2]);
        })));
      }

      _this.boxAnim.setAnimation(0, arr[i++], loop);
    });
  },
  sureBtnClick: function sureBtnClick() {
    if (window.wx) {
      GameApp.uiManager.showToast("暂未开放！");
      return;
    }

    if (!this.onceClick) return;
    this.onceClick = false;
    GameApp.audioManager.playEffect('click');
    var self = this;

    if (window.tt) {
      Utils.addVideo("addVideo", function () {
        //看完了
        self.onceClick = true;
        GameApp.dataManager.addPlayedVideoNum();

        switch (self._itemType) {
          case 1:
            GameApp.dataManager.addCoin(self._itemNum);
            GameApp.uiManager.showToast("获得金币*" + self._itemNum * 2);
            break;

          case 2:
            GameApp.dataManager.addPieceNum(self._pieceIndex, self._itemNum);
            GameApp.uiManager.showToast("获得<color=#faf80d>" + GameApp.dataManager.getSkinDataById(self._pieceIndex).name + "</color> 碎片*" + self._itemNum * 2);
            break;
        }

        GameApp.uiManager.closePopup("OpenBoxPopup");
      }, function (_info) {
        //没看完
        self.onceClick = true;
        _info ? GameApp.uiManager.showToast(_info) : GameApp.uiManager.showToast("未看完视频！");
      });
    } else {
      self.onceClick = true;
      GameApp.dataManager.addPlayedVideoNum();

      switch (self._itemType) {
        case 1:
          GameApp.dataManager.addCoin(self._itemNum);
          GameApp.uiManager.showToast("获得金币*" + self._itemNum * 2);
          break;

        case 2:
          GameApp.dataManager.addPieceNum(self._pieceIndex, self._itemNum);
          GameApp.uiManager.showToast("获得<color=#faf80d>" + GameApp.dataManager.getSkinDataById(self._pieceIndex).name + "</color> 碎片*" + self._itemNum * 2);
          break;
      }

      GameApp.uiManager.closePopup("OpenBoxPopup");
    }
  },
  skipBtnClick: function skipBtnClick() {
    GameApp.audioManager.playEffect('click');
    var self = this;

    switch (self._itemType) {
      case 1:
        GameApp.uiManager.showToast("获得金币*" + self._itemNum);
        break;

      case 2:
        GameApp.uiManager.showToast("获得<color=#faf80d>" + GameApp.dataManager.getSkinDataById(self._pieceIndex).name + "</color> 碎片*" + self._itemNum);
        break;
    }

    GameApp.uiManager.closePopup("OpenBoxPopup");
  },
  addCoin: function addCoin(_num) {
    this.delayShowPanel.children[1].getComponent(cc.RichText).string = "金币*" + _num;
  },
  addPiece: function addPiece(_num, _pieceIndex) {
    this.setpieceIcon(_pieceIndex);
    this.delayShowPanel.children[1].getComponent(cc.RichText).string = "<color=#faf80d>" + GameApp.dataManager.getSkinDataById(_pieceIndex).name + "</color> 碎片*" + _num;
  },
  setpieceIcon: function setpieceIcon(id) {
    var self = this;
    cc.loader.loadRes("texture/skin_piece/card_p_" + id, cc.SpriteFrame, function (err, spriteFrame) {
      self.delayShowPanel.children[0].getComponent(cc.Sprite).spriteFrame = spriteFrame;
    });
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcdWlcXE9wZW5Cb3hQb3B1cC5qcyJdLCJuYW1lcyI6WyJVdGlscyIsInJlcXVpcmUiLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImJveEFuaW0iLCJzcCIsIlNrZWxldG9uIiwiZGVsYXlTaG93UGFuZWwiLCJOb2RlIiwiX2l0ZW1UeXBlIiwiX2l0ZW1OdW0iLCJfcGllY2VJbmRleCIsIm9uY2VDbGljayIsInZpc2libGUiLCJvbkxvYWQiLCJpbml0IiwiX3NraW5EYXRhIiwiX3R5cGUiLCJfbnVtIiwiYWRkQ29pbiIsImFkZFBpZWNlIiwiaW5pdFNraW5TaG93Iiwic2tlbGV0b25EYXRhIiwiYXJyIiwiaSIsInNldEFuaW1hdGlvbiIsInNldENvbXBsZXRlTGlzdGVuZXIiLCJsZW5ndGgiLCJsb29wIiwibm9kZSIsInJ1bkFjdGlvbiIsInNlcXVlbmNlIiwiZGVsYXlUaW1lIiwiY2FsbEZ1bmMiLCJhY3RpdmUiLCJUb29scyIsInNjYWxlVXBBbmREb3dtIiwiY2hpbGRyZW4iLCJzdXJlQnRuQ2xpY2siLCJ3aW5kb3ciLCJ3eCIsIkdhbWVBcHAiLCJ1aU1hbmFnZXIiLCJzaG93VG9hc3QiLCJhdWRpb01hbmFnZXIiLCJwbGF5RWZmZWN0Iiwic2VsZiIsInR0IiwiYWRkVmlkZW8iLCJkYXRhTWFuYWdlciIsImFkZFBsYXllZFZpZGVvTnVtIiwiYWRkUGllY2VOdW0iLCJnZXRTa2luRGF0YUJ5SWQiLCJuYW1lIiwiY2xvc2VQb3B1cCIsIl9pbmZvIiwic2tpcEJ0bkNsaWNrIiwiZ2V0Q29tcG9uZW50IiwiUmljaFRleHQiLCJzdHJpbmciLCJzZXRwaWVjZUljb24iLCJpZCIsImxvYWRlciIsImxvYWRSZXMiLCJTcHJpdGVGcmFtZSIsImVyciIsInNwcml0ZUZyYW1lIiwiU3ByaXRlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQU1BLEtBQUssR0FBR0MsT0FBTyxDQUFDLE9BQUQs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SUFBWDtBQUNBOUMsSUFBQUEsRUFBRSxDQUFDOEQsTUFBSCxDQUFVQyxPQUFWLENBQWtCLCtCQUErQkYsRUFBakQsRUFBcUQ3RCxFQUFFLENBQUNnRSxXQUF4RCxFQUFxRSxVQUFVQyxHQUFWLEVBQWVDLFdBQWYsRUFBNEI7QUFDN0ZwQixNQUFBQSxJQUFJLENBQUN2QyxjQUFMLENBQW9COEIsUUFBcEIsQ0FBNkIsQ0FBN0IsRUFBZ0NvQixZQUFoQyxDQUE2Q3pELEVBQUUsQ0FBQ21FLE1BQWhELEVBQXdERCxXQUF4RCxHQUFzRUEsV0FBdEU7QUFDSCxLQUZEO0FBR0g7QUFuR0ksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgVXRpbHMgPSByZXF1aXJlKFwiVXRpbHNcIilcclxuXHJcbmNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgYm94QW5pbTogc3AuU2tlbGV0b24sXHJcbiAgICAgICAgZGVsYXlTaG93UGFuZWw6IGNjLk5vZGUsIC8vY2hpbGRyZW4gMOaYr+Wbvu+8jDHmmK/lrZdcclxuICAgICAgICBfaXRlbVR5cGU6IDEsXHJcbiAgICAgICAgX2l0ZW1OdW06IDAsXHJcbiAgICAgICAgX3BpZWNlSW5kZXg6IDAsXHJcblxyXG4gICAgICAgIG9uY2VDbGljazoge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiB0cnVlLFxyXG4gICAgICAgICAgICB2aXNpYmxlOiBmYWxzZVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgb25Mb2FkKCkge1xyXG5cclxuICAgIH0sXHJcbiAgICBpbml0KF9za2luRGF0YSwgX3R5cGUsIF9udW0sIF9waWVjZUluZGV4KSB7XHJcbiAgICAgICAgdGhpcy5faXRlbVR5cGUgPSBfdHlwZVxyXG4gICAgICAgIHRoaXMuX2l0ZW1OdW0gPSBfbnVtXHJcbiAgICAgICAgdGhpcy5fcGllY2VJbmRleCA9IF9waWVjZUluZGV4XHJcbiAgICAgICAgc3dpdGNoIChfdHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIDE6IHRoaXMuYWRkQ29pbihfbnVtKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMjogdGhpcy5hZGRQaWVjZShfbnVtLCBfcGllY2VJbmRleCk7IGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmluaXRTa2luU2hvdyhfc2tpbkRhdGEpXHJcbiAgICB9LFxyXG4gICAgaW5pdFNraW5TaG93KF9za2luRGF0YSkge1xyXG4gICAgICAgIHRoaXMuYm94QW5pbS5za2VsZXRvbkRhdGEgPSBfc2tpbkRhdGFcclxuICAgICAgICB2YXIgYXJyID0gWydhcHBlYXInLCAnYmlnLS1zbWFsbCcsICdvcGVuJywgJ29wZW5fYXdhaXQnXS8vLCAnbGFzdF9vcGVuX2F3YWl0J1xyXG4gICAgICAgIHZhciBpID0gMFxyXG4gICAgICAgIHRoaXMuYm94QW5pbS5zZXRBbmltYXRpb24oMCwgYXJyW2krK10sIGZhbHNlKVxyXG4gICAgICAgIHRoaXMuYm94QW5pbS5zZXRDb21wbGV0ZUxpc3RlbmVyKCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKGkgPiBhcnIubGVuZ3RoIC0gMSkgcmV0dXJuO1xyXG4gICAgICAgICAgICB2YXIgbG9vcCA9IChpID09IGFyci5sZW5ndGggLSAxKVxyXG4gICAgICAgICAgICBpZiAoaSA9PSBhcnIubGVuZ3RoIC0gMikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoMC44KSwgY2MuY2FsbEZ1bmMoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVsYXlTaG93UGFuZWwuYWN0aXZlID0gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIFRvb2xzLnNjYWxlVXBBbmREb3dtKHRoaXMuZGVsYXlTaG93UGFuZWwuY2hpbGRyZW5bMl0pXHJcbiAgICAgICAgICAgICAgICB9KSkpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5ib3hBbmltLnNldEFuaW1hdGlvbigwLCBhcnJbaSsrXSwgbG9vcClcclxuICAgICAgICB9KVxyXG4gICAgfSxcclxuICAgIHN1cmVCdG5DbGljaygpIHtcclxuICAgICAgICBpZiAod2luZG93Lnd4KSB7XHJcbiAgICAgICAgICAgIEdhbWVBcHAudWlNYW5hZ2VyLnNob3dUb2FzdChcIuaaguacquW8gOaUvu+8gVwiKVxyXG4gICAgICAgICAgICByZXR1cm5cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLm9uY2VDbGljaykgcmV0dXJuO1xyXG4gICAgICAgIHRoaXMub25jZUNsaWNrID0gZmFsc2VcclxuICAgICAgICBHYW1lQXBwLmF1ZGlvTWFuYWdlci5wbGF5RWZmZWN0KCdjbGljaycpXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzXHJcbiAgICAgICAgaWYgKHdpbmRvdy50dCkge1xyXG4gICAgICAgICAgICBVdGlscy5hZGRWaWRlbyhcImFkZFZpZGVvXCIsIGZ1bmN0aW9uICgpIHsgLy/nnIvlrozkuoZcclxuICAgICAgICAgICAgICAgIHNlbGYub25jZUNsaWNrID0gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgR2FtZUFwcC5kYXRhTWFuYWdlci5hZGRQbGF5ZWRWaWRlb051bSgpXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHNlbGYuX2l0ZW1UeXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOiBHYW1lQXBwLmRhdGFNYW5hZ2VyLmFkZENvaW4oc2VsZi5faXRlbU51bSk7IEdhbWVBcHAudWlNYW5hZ2VyLnNob3dUb2FzdChcIuiOt+W+l+mHkeW4gSpcIiArIHNlbGYuX2l0ZW1OdW0gKiAyKTsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOiBHYW1lQXBwLmRhdGFNYW5hZ2VyLmFkZFBpZWNlTnVtKHNlbGYuX3BpZWNlSW5kZXgsIHNlbGYuX2l0ZW1OdW0pOyBHYW1lQXBwLnVpTWFuYWdlci5zaG93VG9hc3QoXCLojrflvpc8Y29sb3I9I2ZhZjgwZD5cIiArIEdhbWVBcHAuZGF0YU1hbmFnZXIuZ2V0U2tpbkRhdGFCeUlkKHNlbGYuX3BpZWNlSW5kZXgpLm5hbWUgKyBcIjwvY29sb3I+IOeijueJhypcIiArIHNlbGYuX2l0ZW1OdW0gKiAyKTsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBHYW1lQXBwLnVpTWFuYWdlci5jbG9zZVBvcHVwKFwiT3BlbkJveFBvcHVwXCIpXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChfaW5mbykgeyAvL+ayoeeci+WujFxyXG4gICAgICAgICAgICAgICAgc2VsZi5vbmNlQ2xpY2sgPSB0cnVlXHJcbiAgICAgICAgICAgICAgICBfaW5mbyA/IEdhbWVBcHAudWlNYW5hZ2VyLnNob3dUb2FzdChfaW5mbykgOiBHYW1lQXBwLnVpTWFuYWdlci5zaG93VG9hc3QoXCLmnKrnnIvlrozop4bpopHvvIFcIilcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzZWxmLm9uY2VDbGljayA9IHRydWVcclxuICAgICAgICAgICAgR2FtZUFwcC5kYXRhTWFuYWdlci5hZGRQbGF5ZWRWaWRlb051bSgpXHJcbiAgICAgICAgICAgIHN3aXRjaCAoc2VsZi5faXRlbVR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMTogR2FtZUFwcC5kYXRhTWFuYWdlci5hZGRDb2luKHNlbGYuX2l0ZW1OdW0pOyBHYW1lQXBwLnVpTWFuYWdlci5zaG93VG9hc3QoXCLojrflvpfph5HluIEqXCIgKyBzZWxmLl9pdGVtTnVtICogMik7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAyOiBHYW1lQXBwLmRhdGFNYW5hZ2VyLmFkZFBpZWNlTnVtKHNlbGYuX3BpZWNlSW5kZXgsIHNlbGYuX2l0ZW1OdW0pOyBHYW1lQXBwLnVpTWFuYWdlci5zaG93VG9hc3QoXCLojrflvpc8Y29sb3I9I2ZhZjgwZD5cIiArIEdhbWVBcHAuZGF0YU1hbmFnZXIuZ2V0U2tpbkRhdGFCeUlkKHNlbGYuX3BpZWNlSW5kZXgpLm5hbWUgKyBcIjwvY29sb3I+IOeijueJhypcIiArIHNlbGYuX2l0ZW1OdW0gKiAyKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgR2FtZUFwcC51aU1hbmFnZXIuY2xvc2VQb3B1cChcIk9wZW5Cb3hQb3B1cFwiKVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBza2lwQnRuQ2xpY2soKSB7XHJcbiAgICAgICAgR2FtZUFwcC5hdWRpb01hbmFnZXIucGxheUVmZmVjdCgnY2xpY2snKVxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpc1xyXG4gICAgICAgIHN3aXRjaCAoc2VsZi5faXRlbVR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAxOiBHYW1lQXBwLnVpTWFuYWdlci5zaG93VG9hc3QoXCLojrflvpfph5HluIEqXCIgKyBzZWxmLl9pdGVtTnVtKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMjogR2FtZUFwcC51aU1hbmFnZXIuc2hvd1RvYXN0KFwi6I635b6XPGNvbG9yPSNmYWY4MGQ+XCIgKyBHYW1lQXBwLmRhdGFNYW5hZ2VyLmdldFNraW5EYXRhQnlJZChzZWxmLl9waWVjZUluZGV4KS5uYW1lICsgXCI8L2NvbG9yPiDnoo7niYcqXCIgKyBzZWxmLl9pdGVtTnVtKTsgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIEdhbWVBcHAudWlNYW5hZ2VyLmNsb3NlUG9wdXAoXCJPcGVuQm94UG9wdXBcIilcclxuICAgIH0sXHJcbiAgICBhZGRDb2luKF9udW0pIHtcclxuICAgICAgICB0aGlzLmRlbGF5U2hvd1BhbmVsLmNoaWxkcmVuWzFdLmdldENvbXBvbmVudChjYy5SaWNoVGV4dCkuc3RyaW5nID0gXCLph5HluIEqXCIgKyBfbnVtXHJcbiAgICB9LFxyXG4gICAgYWRkUGllY2UoX251bSwgX3BpZWNlSW5kZXgpIHtcclxuICAgICAgICB0aGlzLnNldHBpZWNlSWNvbihfcGllY2VJbmRleCk7XHJcbiAgICAgICAgdGhpcy5kZWxheVNob3dQYW5lbC5jaGlsZHJlblsxXS5nZXRDb21wb25lbnQoY2MuUmljaFRleHQpLnN0cmluZyA9IFwiPGNvbG9yPSNmYWY4MGQ+XCIgKyBHYW1lQXBwLmRhdGFNYW5hZ2VyLmdldFNraW5EYXRhQnlJZChfcGllY2VJbmRleCkubmFtZSArIFwiPC9jb2xvcj4g56KO54mHKlwiICsgX251bVxyXG4gICAgfSxcclxuICAgIHNldHBpZWNlSWNvbihpZCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpc1xyXG4gICAgICAgIGNjLmxvYWRlci5sb2FkUmVzKFwidGV4dHVyZS9za2luX3BpZWNlL2NhcmRfcF9cIiArIGlkLCBjYy5TcHJpdGVGcmFtZSwgZnVuY3Rpb24gKGVyciwgc3ByaXRlRnJhbWUpIHtcclxuICAgICAgICAgICAgc2VsZi5kZWxheVNob3dQYW5lbC5jaGlsZHJlblswXS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHNwcml0ZUZyYW1lXHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG59KTtcclxuIl19