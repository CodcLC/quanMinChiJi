
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/ui/SkinItem.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '400f7aj7KtIOIhHbYk3GMvQ', 'SkinItem');
// scripts/ui/SkinItem.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    actorAnim: sp.Skeleton,
    nameUI: cc.Label,
    skinData: {
      "default": {}
    },
    methodBtnGroup: [cc.Node]
  },
  onLoad: function onLoad() {
    GameApp.eventManager.on(EventNames.EVENT_UPDATE_SHOP_CHOOSED_SHOW, this.updateUnLockShow.bind(this));
  },
  onDestroy: function onDestroy() {
    GameApp.eventManager.removeListener(EventNames.EVENT_UPDATE_SHOP_CHOOSED_SHOW);
  },
  // update (dt) {},
  init: function init(_skinData) {
    this.skinData = _skinData;
    this.initNameShow();
    this.initSkinShow();
    this.updateMethodShow();
  },
  initNameShow: function initNameShow() {
    this.nameUI.string = this.skinData.name;
    var colorIndex = Math.floor((this.skinData.skinid - 1) / 5);
    this.nameUI.node.color = new cc.Color().fromHEX(NameColor[colorIndex]);
  },
  initSkinShow: function initSkinShow() {
    var _this = this;

    if (this.skinData.skinid < 21) {
      this.actorAnim.skeletonData = GameApp.uiManager.normalSkinData;
      this.actorAnim.setSkin(this.skinData.skinname);
    } else {
      this.actorAnim.skeletonData = GameApp.uiManager.advanceSkinDataGroup[this.skinData.skinid - 21];
    }

    if (this.skinData.skinid < 21) {
      this.actorAnim.setAnimation(0, 'await', true);
    } else {
      this.actorAnim.setAnimation(0, 'await_main_1', false);
      this.actorAnim.setCompleteListener(function () {
        _this.actorAnim.setAnimation(0, 'await_main_' + Tools.randomNum(1, 3), false);
      });
    }
  },
  updateMethodShow: function updateMethodShow() {
    if (this.skinData.skinid > 25) {
      this.methodBtnGroup[2].children[1].getComponent(cc.Label).string = GameApp.dataManager.userData.havePieceNum[this.skinData.skinid] + '/' + this.skinData.needpiece;
      this.setpieceIcon(this.skinData.skinid);
    }

    this.updateUnLockShow();
  },
  updateUnLockShow: function updateUnLockShow() {
    var _this2 = this;

    this.methodBtnGroup[0].active = this.skinData.needcoin;
    this.methodBtnGroup[1].active = this.skinData.needgem;
    this.methodBtnGroup[2].active = this.skinData.needpiece;
    this.methodBtnGroup[3].active = false;
    this.methodBtnGroup[0].children[1].getComponent(cc.Label).string = this.skinData.needcoin;
    this.methodBtnGroup[1].children[1].getComponent(cc.Label).string = GameApp.dataManager.userData.playedVideoNum + '/' + this.skinData.needgem;
    var unlockarr = GameApp.dataManager.userData.unLockedSkinIdArr.concat();
    unlockarr.sort(function (a, b) {
      return a - b;
    });
    unlockarr.forEach(function (element) {
      if (element == _this2.skinData.skinid) {
        _this2.methodBtnGroup[0].active = false;
        _this2.methodBtnGroup[1].active = false;
        _this2.methodBtnGroup[2].active = false;
        _this2.methodBtnGroup[3].active = true;
        return;
      }
    });
    this.updateChoosedShow();
  },
  updateChoosedShow: function updateChoosedShow() {
    if (GameApp.dataManager.getChoosedSkinId() == this.skinData.skinid) {
      this.methodBtnGroup[3].children[0].active = false;
      this.methodBtnGroup[3].children[1].active = true;
    } else {
      this.methodBtnGroup[3].children[0].active = true;
      this.methodBtnGroup[3].children[1].active = false;
    }
  },
  setpieceIcon: function setpieceIcon(id) {
    var self = this;
    cc.loader.loadRes("texture/skin_piece/card_p_" + id, cc.SpriteFrame, function (err, spriteFrame) {
      self.methodBtnGroup[2].children[0].getComponent(cc.Sprite).spriteFrame = spriteFrame;
    });
  },
  frameBtnClick: function frameBtnClick() {
    var _this3 = this;

    GameApp.audioManager.playEffect('click');
    GameApp.uiManager.showPopup("SkinInfoPopup", function (node) {
      node.getComponent("SkinInfoPopup").init(_this3.skinData);
    }, false);
  },
  selelctBtnClick: function selelctBtnClick() {
    GameApp.audioManager.playEffect('click');
    GameApp.dataManager.setChoosedSkinId(this.skinData.skinid);
    GameApp.eventManager.emit(EventNames.EVENT_UPDATE_SHOP_CHOOSED_SHOW);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcdWlcXFNraW5JdGVtLmpzIl0sIm5hbWVzIjpbImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiYWN0b3JBbmltIiwic3AiLCJTa2VsZXRvbiIsIm5hbWVVSSIsIkxhYmVsIiwic2tpbkRhdGEiLCJtZXRob2RCdG5Hcm91cCIsIk5vZGUiLCJvbkxvYWQiLCJHYW1lQXBwIiwiZXZlbnRNYW5hZ2VyIiwib24iLCJFdmVudE5hbWVzIiwiRVZFTlRfVVBEQVRFX1NIT1BfQ0hPT1NFRF9TSE9XIiwidXBkYXRlVW5Mb2NrU2hvdyIsImJpbmQiLCJvbkRlc3Ryb3kiLCJyZW1vdmVMaXN0ZW5lciIsImluaXQiLCJfc2tpbkRhdGEiLCJpbml0TmFtZVNob3ciLCJpbml0U2tpblNob3ciLCJ1cGRhdGVNZXRob2RTaG93Iiwic3RyaW5nIiwibmFtZSIsImNvbG9ySW5kZXgiLCJNYXRoIiwiZmxvb3IiLCJza2luaWQiLCJub2RlIiwiY29sb3IiLCJDb2xvciIsImZyb21IRVgiLCJOYW1lQ29sb3IiLCJza2VsZXRvbkRhdGEiLCJ1aU1hbmFnZXIiLCJub3JtYWxTa2luRGF0YSIsInNldFNraW4iLCJza2lubmFtZSIsImFkdmFuY2VTa2luRGF0YUdyb3VwIiwic2V0QW5pbWF0aW9uIiwic2V0Q29tcGxldGVMaXN0ZW5lciIsIlRvb2xzIiwicmFuZG9tTnVtIiwiY2hpbGRyZW4iLCJnZXRDb21wb25lbnQiLCJkYXRhTWFuYWdlciIsInVzZXJEYXRhIiwiaGF2ZVBpZWNlTnVtIiwibmVlZHBpZWNlIiwic2V0cGllY2VJY29uIiwiYWN0aXZlIiwibmVlZGNvaW4iLCJuZWVkZ2VtIiwicGxheWVkVmlkZW9OdW0iLCJ1bmxvY2thcnIiLCJ1bkxvY2tlZFNraW5JZEFyciIsImNvbmNhdCIsInNvcnQiLCJhIiwiYiIsImZvckVhY2giLCJlbGVtZW50IiwidXBkYXRlQ2hvb3NlZFNob3ciLCJnZXRDaG9vc2VkU2tpbklkIiwiaWQiLCJzZWxmIiwibG9hZGVyIiwibG9hZFJlcyIsIlNwcml0ZUZyYW1lIiwiZXJyIiwic3ByaXRlRnJhbWUiLCJTcHJpdGUiLCJmcmFtZUJ0bkNsaWNrIiwiYXVkaW9NYW5hZ2VyIiwicGxheUVmZmVjdCIsInNob3dQb3B1cCIsInNlbGVsY3RCdG5DbGljayIsInNldENob29zZWRTa2luSWQiLCJlbWl0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUNBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUsQ0FBQ0UsU0FEUDtBQUdMQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsU0FBUyxFQUFFQyxFQUFFLENBQUNDLFFBRE47QUFFUkMsSUFBQUEsTUFBTSxFQUFFUCxFQUFFLENBQUNRLEtBRkg7QUFHUkMsSUFBQUEsUUFBUSxFQUFFO0FBQ04saUJBQVM7QUFESCxLQUhGO0FBTVJDLElBQUFBLGNBQWMsRUFBRSxDQUFDVixFQUFFLENBQUNXLElBQUo7QUFOUixHQUhQO0FBWUxDLEVBQUFBLE1BWkssb0JBWUk7QUFDTEMsSUFBQUEsT0FBTyxDQUFDQyxZQUFSLENBQXFCQyxFQUFyQixDQUF3QkMsVUFBVSxDQUFDQyw4QkFBbkMsRUFBbUUsS0FBS0MsZ0JBQUwsQ0FBc0JDLElBQXRCLENBQTJCLElBQTNCLENBQW5FO0FBQ0gsR0FkSTtBQWVMQyxFQUFBQSxTQWZLLHVCQWVPO0FBQ1JQLElBQUFBLE9BQU8sQ0FBQ0MsWUFBUixDQUFxQk8sY0FBckIsQ0FBb0NMLFVBQVUsQ0FBQ0MsOEJBQS9DO0FBQ0gsR0FqQkk7QUFrQkw7QUFDQUssRUFBQUEsSUFuQkssZ0JBbUJBQyxTQW5CQSxFQW1CVztBQUNaLFNBQUtkLFFBQUwsR0FBZ0JjLFNBQWhCO0FBQ0EsU0FBS0MsWUFBTDtBQUNBLFNBQUtDLFlBQUw7QUFDQSxTQUFLQyxnQkFBTDtBQUNILEdBeEJJO0FBeUJMRixFQUFBQSxZQXpCSywwQkF5QlU7QUFDWCxTQUFLakIsTUFBTCxDQUFZb0IsTUFBWixHQUFxQixLQUFLbEIsUUFB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QUFJLENBQUNnQixZQUFMLENBQWtCLGVBQWxCLEVBQW1DM0IsSUFBbkMsQ0FBd0MsTUFBSSxDQUFDYixRQUE3QztBQUNILEtBRkQsRUFFRyxLQUZIO0FBR0gsR0EvRkk7QUFnR0x3RSxFQUFBQSxlQWhHSyw2QkFnR2E7QUFDZHBFLElBQUFBLE9BQU8sQ0FBQ2lFLFlBQVIsQ0FBcUJDLFVBQXJCLENBQWdDLE9BQWhDO0FBQ0FsRSxJQUFBQSxPQUFPLENBQUNxQyxXQUFSLENBQW9CZ0MsZ0JBQXBCLENBQXFDLEtBQUt6RSxRQUFMLENBQWN1QixNQUFuRDtBQUNBbkIsSUFBQUEsT0FBTyxDQUFDQyxZQUFSLENBQXFCcUUsSUFBckIsQ0FBMEJuRSxVQUFVLENBQUNDLDhCQUFyQztBQUNIO0FBcEdJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5jYy5DbGFzcyh7XHJcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcblxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGFjdG9yQW5pbTogc3AuU2tlbGV0b24sXHJcbiAgICAgICAgbmFtZVVJOiBjYy5MYWJlbCxcclxuICAgICAgICBza2luRGF0YToge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiB7fVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbWV0aG9kQnRuR3JvdXA6IFtjYy5Ob2RlXVxyXG4gICAgfSxcclxuXHJcbiAgICBvbkxvYWQoKSB7XHJcbiAgICAgICAgR2FtZUFwcC5ldmVudE1hbmFnZXIub24oRXZlbnROYW1lcy5FVkVOVF9VUERBVEVfU0hPUF9DSE9PU0VEX1NIT1csIHRoaXMudXBkYXRlVW5Mb2NrU2hvdy5iaW5kKHRoaXMpKVxyXG4gICAgfSxcclxuICAgIG9uRGVzdHJveSgpIHtcclxuICAgICAgICBHYW1lQXBwLmV2ZW50TWFuYWdlci5yZW1vdmVMaXN0ZW5lcihFdmVudE5hbWVzLkVWRU5UX1VQREFURV9TSE9QX0NIT09TRURfU0hPVylcclxuICAgIH0sXHJcbiAgICAvLyB1cGRhdGUgKGR0KSB7fSxcclxuICAgIGluaXQoX3NraW5EYXRhKSB7XHJcbiAgICAgICAgdGhpcy5za2luRGF0YSA9IF9za2luRGF0YVxyXG4gICAgICAgIHRoaXMuaW5pdE5hbWVTaG93KClcclxuICAgICAgICB0aGlzLmluaXRTa2luU2hvdygpXHJcbiAgICAgICAgdGhpcy51cGRhdGVNZXRob2RTaG93KClcclxuICAgIH0sXHJcbiAgICBpbml0TmFtZVNob3coKSB7XHJcbiAgICAgICAgdGhpcy5uYW1lVUkuc3RyaW5nID0gdGhpcy5za2luRGF0YS5uYW1lXHJcbiAgICAgICAgdmFyIGNvbG9ySW5kZXggPSBNYXRoLmZsb29yKCh0aGlzLnNraW5EYXRhLnNraW5pZCAtIDEpIC8gNSlcclxuICAgICAgICB0aGlzLm5hbWVVSS5ub2RlLmNvbG9yID0gbmV3IGNjLkNvbG9yKCkuZnJvbUhFWChOYW1lQ29sb3JbY29sb3JJbmRleF0pO1xyXG4gICAgfSxcclxuICAgIGluaXRTa2luU2hvdygpIHtcclxuICAgICAgICBpZiAodGhpcy5za2luRGF0YS5za2luaWQgPCAyMSkge1xyXG4gICAgICAgICAgICB0aGlzLmFjdG9yQW5pbS5za2VsZXRvbkRhdGEgPSBHYW1lQXBwLnVpTWFuYWdlci5ub3JtYWxTa2luRGF0YVxyXG4gICAgICAgICAgICB0aGlzLmFjdG9yQW5pbS5zZXRTa2luKHRoaXMuc2tpbkRhdGEuc2tpbm5hbWUpXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5hY3RvckFuaW0uc2tlbGV0b25EYXRhID0gR2FtZUFwcC51aU1hbmFnZXIuYWR2YW5jZVNraW5EYXRhR3JvdXBbdGhpcy5za2luRGF0YS5za2luaWQgLSAyMV1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuc2tpbkRhdGEuc2tpbmlkIDwgMjEpIHtcclxuICAgICAgICAgICAgdGhpcy5hY3RvckFuaW0uc2V0QW5pbWF0aW9uKDAsICdhd2FpdCcsIHRydWUpXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5hY3RvckFuaW0uc2V0QW5pbWF0aW9uKDAsICdhd2FpdF9tYWluXzEnLCBmYWxzZSlcclxuICAgICAgICAgICAgdGhpcy5hY3RvckFuaW0uc2V0Q29tcGxldGVMaXN0ZW5lcigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFjdG9yQW5pbS5zZXRBbmltYXRpb24oMCwgJ2F3YWl0X21haW5fJyArIFRvb2xzLnJhbmRvbU51bSgxLCAzKSwgZmFsc2UpXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHVwZGF0ZU1ldGhvZFNob3coKSB7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnNraW5EYXRhLnNraW5pZCA+IDI1KSB7XHJcbiAgICAgICAgICAgIHRoaXMubWV0aG9kQnRuR3JvdXBbMl0uY2hpbGRyZW5bMV0uZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBHYW1lQXBwLmRhdGFNYW5hZ2VyLnVzZXJEYXRhLmhhdmVQaWVjZU51bVt0aGlzLnNraW5EYXRhLnNraW5pZF0gKyAnLycgKyB0aGlzLnNraW5EYXRhLm5lZWRwaWVjZVxyXG4gICAgICAgICAgICB0aGlzLnNldHBpZWNlSWNvbih0aGlzLnNraW5EYXRhLnNraW5pZClcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGRhdGVVbkxvY2tTaG93KClcclxuICAgIH0sXHJcbiAgICB1cGRhdGVVbkxvY2tTaG93KCkge1xyXG4gICAgICAgIHRoaXMubWV0aG9kQnRuR3JvdXBbMF0uYWN0aXZlID0gdGhpcy5za2luRGF0YS5uZWVkY29pblxyXG4gICAgICAgIHRoaXMubWV0aG9kQnRuR3JvdXBbMV0uYWN0aXZlID0gdGhpcy5za2luRGF0YS5uZWVkZ2VtXHJcbiAgICAgICAgdGhpcy5tZXRob2RCdG5Hcm91cFsyXS5hY3RpdmUgPSB0aGlzLnNraW5EYXRhLm5lZWRwaWVjZVxyXG4gICAgICAgIHRoaXMubWV0aG9kQnRuR3JvdXBbM10uYWN0aXZlID0gZmFsc2VcclxuICAgICAgICB0aGlzLm1ldGhvZEJ0bkdyb3VwWzBdLmNoaWxkcmVuWzFdLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gdGhpcy5za2luRGF0YS5uZWVkY29pblxyXG4gICAgICAgIHRoaXMubWV0aG9kQnRuR3JvdXBbMV0uY2hpbGRyZW5bMV0uZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBHYW1lQXBwLmRhdGFNYW5hZ2VyLnVzZXJEYXRhLnBsYXllZFZpZGVvTnVtICsgJy8nICsgdGhpcy5za2luRGF0YS5uZWVkZ2VtXHJcblxyXG4gICAgICAgIHZhciB1bmxvY2thcnIgPSBHYW1lQXBwLmRhdGFNYW5hZ2VyLnVzZXJEYXRhLnVuTG9ja2VkU2tpbklkQXJyLmNvbmNhdCgpXHJcbiAgICAgICAgdW5sb2NrYXJyLnNvcnQoKGEsIGIpID0+IGEgLSBiKTtcclxuICAgICAgICB1bmxvY2thcnIuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQgPT0gdGhpcy5za2luRGF0YS5za2luaWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubWV0aG9kQnRuR3JvdXBbMF0uYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1ldGhvZEJ0bkdyb3VwWzFdLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tZXRob2RCdG5Hcm91cFsyXS5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHRoaXMubWV0aG9kQnRuR3JvdXBbM10uYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMudXBkYXRlQ2hvb3NlZFNob3coKVxyXG4gICAgfSxcclxuICAgIHVwZGF0ZUNob29zZWRTaG93KCkge1xyXG4gICAgICAgIGlmIChHYW1lQXBwLmRhdGFNYW5hZ2VyLmdldENob29zZWRTa2luSWQoKSA9PSB0aGlzLnNraW5EYXRhLnNraW5pZCkge1xyXG4gICAgICAgICAgICB0aGlzLm1ldGhvZEJ0bkdyb3VwWzNdLmNoaWxkcmVuWzBdLmFjdGl2ZSA9IGZhbHNlXHJcbiAgICAgICAgICAgIHRoaXMubWV0aG9kQnRuR3JvdXBbM10uY2hpbGRyZW5bMV0uYWN0aXZlID0gdHJ1ZVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubWV0aG9kQnRuR3JvdXBbM10uY2hpbGRyZW5bMF0uYWN0aXZlID0gdHJ1ZVxyXG4gICAgICAgICAgICB0aGlzLm1ldGhvZEJ0bkdyb3VwWzNdLmNoaWxkcmVuWzFdLmFjdGl2ZSA9IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHNldHBpZWNlSWNvbihpZCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpc1xyXG4gICAgICAgIGNjLmxvYWRlci5sb2FkUmVzKFwidGV4dHVyZS9za2luX3BpZWNlL2NhcmRfcF9cIiArIGlkLCBjYy5TcHJpdGVGcmFtZSwgZnVuY3Rpb24gKGVyciwgc3ByaXRlRnJhbWUpIHtcclxuICAgICAgICAgICAgc2VsZi5tZXRob2RCdG5Hcm91cFsyXS5jaGlsZHJlblswXS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHNwcml0ZUZyYW1lXHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZnJhbWVCdG5DbGljaygpIHtcclxuICAgICAgICBHYW1lQXBwLmF1ZGlvTWFuYWdlci5wbGF5RWZmZWN0KCdjbGljaycpXHJcbiAgICAgICAgR2FtZUFwcC51aU1hbmFnZXIuc2hvd1BvcHVwKFwiU2tpbkluZm9Qb3B1cFwiLCAobm9kZSkgPT4ge1xyXG4gICAgICAgICAgICBub2RlLmdldENvbXBvbmVudChcIlNraW5JbmZvUG9wdXBcIikuaW5pdCh0aGlzLnNraW5EYXRhKVxyXG4gICAgICAgIH0sIGZhbHNlKVxyXG4gICAgfSxcclxuICAgIHNlbGVsY3RCdG5DbGljaygpIHtcclxuICAgICAgICBHYW1lQXBwLmF1ZGlvTWFuYWdlci5wbGF5RWZmZWN0KCdjbGljaycpXHJcbiAgICAgICAgR2FtZUFwcC5kYXRhTWFuYWdlci5zZXRDaG9vc2VkU2tpbklkKHRoaXMuc2tpbkRhdGEuc2tpbmlkKVxyXG4gICAgICAgIEdhbWVBcHAuZXZlbnRNYW5hZ2VyLmVtaXQoRXZlbnROYW1lcy5FVkVOVF9VUERBVEVfU0hPUF9DSE9PU0VEX1NIT1cpXHJcbiAgICB9LFxyXG59KTtcclxuIl19