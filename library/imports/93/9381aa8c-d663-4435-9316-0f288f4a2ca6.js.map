{"version":3,"sources":["assets\\scripts\\ui\\OverPopup.js"],"names":["Utils","require","cc","Class","Component","properties","winTitle","Node","winSprite","loseTitle","nameUI","Label","rankUI","killUI","allRewardUI","rankRewardUI","killRewardUI","rewardBtnNode","Button","homeBtnNode","onceClick","visible","clickedShare","onLoad","node","runAction","sequence","delayTime","callFunc","active","Tools","scaleUpAndDowm","init","_isWin","rank","GameApp","dataManager","userData","winNum","addActivityNum","alDieNum","top5Num","string","playerName","killNum","globalData","inGameKillNum","_killNum","allKillNum","rankCoin","killCoin","allCoin","allPlayNum","winRate","toFixed","kd","avgRank","parseInt","mostKill","avgLifeTime","lifeTime","addCoin","homeBtnClick","audioManager","playEffect","uiManager","showUI","rewardBtnClick","window","wx","showToast","self","tt","addVideo","addPlayedVideoNum","showPopup","getNum","randomNum","getComponent","boxSkinDataGroup","interactable","_info","recordBtnClick","shareRecord","recordPath","console","log","changeRecordState","RecordState","READY","recordTimer","stopRecord","res","videoPath"],"mappings":"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","sourceRoot":"/","sourcesContent":["const Utils = require(\"Utils\")\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        winTitle: cc.Node,\r\n        winSprite: cc.Node,\r\n        loseTitle: cc.Node,\r\n        nameUI: cc.Label,\r\n        rankUI: cc.Label,\r\n        killUI: cc.Label,\r\n        allRewardUI: cc.Label,\r\n        rankRewardUI: cc.Label,\r\n        killRewardUI: cc.Label,\r\n        rewardBtnNode: cc.Button,\r\n        homeBtnNode: cc.Node,\r\n        onceClick: {\r\n            default: true,\r\n            visible: false\r\n        },\r\n        clickedShare: {\r\n            default: false,\r\n            visible: false\r\n        },\r\n    },\r\n\r\n\r\n    onLoad() {\r\n        // Utils.addInsertAd(\"addInsertAd\")\r\n        this.node.runAction(cc.sequence(cc.delayTime(3), cc.callFunc(() => {\r\n            this.homeBtnNode.active = true\r\n        })))\r\n        Tools.scaleUpAndDowm(this.rewardBtnNode.node)\r\n    },\r\n    init(_isWin, rank) {\r\n        if (_isWin) {\r\n            rank = 1\r\n            this.winTitle.active = true\r\n            this.winSprite.active = true\r\n            GameApp.dataManager.userData.winNum++\r\n            GameApp.dataManager.addActivityNum(2, 1)\r\n        } else {\r\n            this.loseTitle.active = true\r\n            GameApp.dataManager.userData.alDieNum++\r\n        }\r\n        if (rank <= 5) {\r\n            GameApp.dataManager.userData.top5Num++\r\n        }\r\n\r\n        this.nameUI.string = GameApp.dataManager.userData.playerName\r\n        this.rankUI.string = rank\r\n        var killNum = GameApp.dataManager.globalData.inGameKillNum[0]._killNum\r\n\r\n        GameApp.dataManager.userData.allKillNum += killNum\r\n\r\n        this.killUI.string = killNum\r\n        var rankCoin = (30 - rank) * 50\r\n        var killCoin = 100 * killNum\r\n        var allCoin = rankCoin + killCoin\r\n        this.allRewardUI.string = allCoin\r\n        this.rankRewardUI.string = rankCoin\r\n        this.killRewardUI.string = killCoin\r\n\r\n        GameApp.dataManager.userData.allPlayNum++\r\n        GameApp.dataManager.userData.winRate = (GameApp.dataManager.userData.winNum / GameApp.dataManager.userData.allPlayNum).toFixed(2)\r\n        GameApp.dataManager.userData.kd = (GameApp.dataManager.userData.allKillNum / (GameApp.dataManager.userData.alDieNum == 0 ? 1 : GameApp.dataManager.userData.alDieNum)).toFixed(2)\r\n        GameApp.dataManager.userData.avgRank = parseInt((GameApp.dataManager.userData.avgRank + rank) / GameApp.dataManager.userData.allPlayNum)\r\n        GameApp.dataManager.userData.mostKill = killNum > GameApp.dataManager.userData.mostKill ? killNum : GameApp.dataManager.userData.mostKill\r\n        GameApp.dataManager.userData.avgLifeTime = parseInt((GameApp.dataManager.userData.avgLifeTime + GameApp.dataManager.globalData.lifeTime) / GameApp.dataManager.userData.allPlayNum)\r\n        GameApp.dataManager.addCoin(allCoin)\r\n    },\r\n    homeBtnClick() {\r\n        GameApp.audioManager.playEffect('click')\r\n        GameApp.uiManager.showUI(\"LoginUI\")\r\n    },\r\n    rewardBtnClick() {\r\n        if (window.wx) {\r\n            GameApp.uiManager.showToast(\"暂未开放！\")\r\n            return\r\n        }\r\n        if (!this.onceClick) return;\r\n        this.onceClick = false\r\n        GameApp.audioManager.playEffect('click')\r\n        var self = this\r\n        if (window.tt) {\r\n            Utils.addVideo(\"addVideo\", function () { //看完了\r\n                self.onceClick = true\r\n                GameApp.dataManager.addPlayedVideoNum()\r\n                GameApp.uiManager.showPopup('OpenBoxPopup', (node) => {\r\n                    var getNum = Tools.randomNum(100, 1000)\r\n                    GameApp.dataManager.addCoin(getNum)\r\n                    node.getComponent('OpenBoxPopup').init(GameApp.uiManager.boxSkinDataGroup[1], 1, getNum)\r\n                    self.onceClick = true\r\n                    self.rewardBtnNode.interactable = false\r\n                }, false)\r\n            }, function (_info) { //没看完\r\n                self.onceClick = true\r\n                _info ? GameApp.uiManager.showToast(_info) : GameApp.uiManager.showToast(\"未看完视频！\")\r\n            })\r\n        } else {\r\n            self.onceClick = true\r\n            GameApp.dataManager.addPlayedVideoNum()\r\n            GameApp.uiManager.showPopup('OpenBoxPopup', (node) => {\r\n                var getNum = Tools.randomNum(100, 1000)\r\n                GameApp.dataManager.addCoin(getNum)\r\n                node.getComponent('OpenBoxPopup').init(GameApp.uiManager.boxSkinDataGroup[1], 1, getNum)\r\n                self.onceClick = true\r\n                self.rewardBtnNode.interactable = false\r\n            }, false)\r\n        }\r\n    },\r\n    recordBtnClick() {\r\n        if (!this.onceClick) return\r\n        this.onceClick = false\r\n        var self = this\r\n        GameApp.audioManager.playEffect('click')\r\n        if (this.clickedShare) {\r\n            Utils.shareRecord(GameApp.dataManager.globalData.recordPath, function () {\r\n                // GameApp.dataManager.changeRecordState(RecordState.RECORD)\r\n                self.onceClick = true\r\n                console.log(\"分享完成了\")\r\n            }, function () {\r\n                self.onceClick = true\r\n                console.log(\"分享失败了\")\r\n            })\r\n            GameApp.dataManager.changeRecordState(RecordState.READY)\r\n            return;\r\n        }\r\n        if (GameApp.dataManager.globalData.recordTimer < 3) {\r\n            self.onceClick = true\r\n            GameApp.uiManager.showToast(\"录屏时间小于3秒!\")\r\n            // console.log(\"请过一会儿再分享\")\r\n            return;\r\n        } else {\r\n            console.log(\"结束了\")\r\n            var self = this\r\n            Utils.stopRecord(function (res) {\r\n                if (res != null) {\r\n                    GameApp.dataManager.globalData.recordPath = res.videoPath\r\n                }\r\n                self.clickedShare = true\r\n                GameApp.dataManager.changeRecordState(RecordState.READY)\r\n                Utils.shareRecord(GameApp.dataManager.globalData.recordPath, function () {\r\n                    // GameApp.dataManager.changeRecordState(RecordState.RECORD)\r\n                    self.onceClick = true\r\n                    console.log(\"分享完成了\")\r\n                }, function () {\r\n                    self.onceClick = true\r\n                    console.log(\"分享失败了\")\r\n                })\r\n\r\n            })\r\n\r\n        }\r\n    },\r\n});\r\n"]}