{"version":3,"sources":["assets\\scripts\\ui\\SkinInfoPopup.js"],"names":["Utils","require","cc","Class","Component","properties","actorAnim","sp","Skeleton","nameUI","Label","descUI","skinData","methodUIGroup","Node","methodBtnGroup","onceClick","visible","onLoad","GameApp","eventManager","on","EventNames","EVENT_UPDATE_SHOP_CHOOSED_SHOW","updateUnLockShow","onDestroy","removeListener","init","_skinData","initNameShow","initSkinShow","updateMethodShow","string","name","colorIndex","Math","floor","skinid","node","color","Color","fromHEX","NameColor","des","skeletonData","uiManager","normalSkinData","setSkin","skinname","advanceSkinDataGroup","setAnimation","setCompleteListener","Tools","randomNum","children","getComponent","dataManager","userData","havePieceNum","needpiece","setpieceIcon","self","active","needcoin","needgem","playedVideoNum","unlockarr","unLockedSkinIdArr","concat","sort","a","b","forEach","element","updateChoosedShow2","getChoosedSkinId","id","loader","loadRes","SpriteFrame","err","spriteFrame","Sprite","selelctBtnClick","audioManager","playEffect","setChoosedSkinId","emit","coinBtnClick","reduceCoin","showToast","unLockSkin","videoBtnClick","window","wx","tt","addVideo","addPlayedVideoNum","_info","pieceBtnClick","onCloseBtnClick","closePopup"],"mappings":"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","sourceRoot":"/","sourcesContent":["const Utils = require(\"Utils\")\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        actorAnim: sp.Skeleton,\r\n        nameUI: cc.Label,\r\n        descUI: cc.Label,\r\n        skinData: {\r\n            default: {}\r\n        },\r\n        methodUIGroup: [cc.Node],\r\n        methodBtnGroup: [cc.Node],\r\n        onceClick: {\r\n            default: true,\r\n            visible: false\r\n        }\r\n    },\r\n\r\n    onLoad() {\r\n        GameApp.eventManager.on(EventNames.EVENT_UPDATE_SHOP_CHOOSED_SHOW, this.updateUnLockShow)\r\n    },\r\n    onDestroy() {\r\n        GameApp.eventManager.removeListener(EventNames.EVENT_UPDATE_SHOP_CHOOSED_SHOW, this.updateUnLockShow)\r\n    },\r\n\r\n    // update (dt) {},\r\n\r\n    init(_skinData) {\r\n        this.skinData = _skinData\r\n        this.initNameShow()\r\n        this.initSkinShow()\r\n        this.updateMethodShow()\r\n    },\r\n    initNameShow() {\r\n        this.nameUI.string = this.skinData.name\r\n        var colorIndex = Math.floor((this.skinData.skinid - 1) / 5)\r\n        this.nameUI.node.color = new cc.Color().fromHEX(NameColor[colorIndex]);\r\n\r\n        this.descUI.string = this.skinData.des\r\n    },\r\n    initSkinShow() {\r\n        if (this.skinData.skinid < 21) {\r\n            this.actorAnim.skeletonData = GameApp.uiManager.normalSkinData\r\n            this.actorAnim.setSkin(this.skinData.skinname)\r\n        } else {\r\n            this.actorAnim.skeletonData = GameApp.uiManager.advanceSkinDataGroup[this.skinData.skinid - 21]\r\n        }\r\n        if (this.skinData.skinid < 21) {\r\n            this.actorAnim.setAnimation(0, 'await', true)\r\n        } else {\r\n            this.actorAnim.setAnimation(0, 'await_main_1', false)\r\n            this.actorAnim.setCompleteListener(() => {\r\n                this.actorAnim.setAnimation(0, 'await_main_' + Tools.randomNum(1, 3), false)\r\n            })\r\n        }\r\n    },\r\n    updateMethodShow() {\r\n\r\n        if (this.skinData.skinid > 25) {\r\n            this.methodUIGroup[2].children[0].getComponent(cc.Label).string = GameApp.dataManager.userData.havePieceNum[this.skinData.skinid] + '/' + this.skinData.needpiece\r\n            this.setpieceIcon(this.skinData.skinid)\r\n        }\r\n\r\n        this.updateUnLockShow(this)\r\n    },\r\n    updateUnLockShow(self) {\r\n        self.methodUIGroup[0].active = self.methodBtnGroup[0].active = self.skinData.needcoin\r\n        self.methodUIGroup[1].active = self.methodBtnGroup[1].active = self.skinData.needgem\r\n        self.methodUIGroup[2].active = self.methodBtnGroup[2].active = self.skinData.needpiece\r\n        self.methodBtnGroup[3].active = false\r\n        self.methodUIGroup[0].children[0].getComponent(cc.Label).string = self.skinData.needcoin\r\n        self.methodUIGroup[1].children[0].getComponent(cc.Label).string = GameApp.dataManager.userData.playedVideoNum + '/' + self.skinData.needgem\r\n\r\n        var unlockarr = GameApp.dataManager.userData.unLockedSkinIdArr.concat()\r\n        unlockarr.sort((a, b) => a - b);\r\n        unlockarr.forEach(element => {\r\n            if (element == self.skinData.skinid) {\r\n                self.methodBtnGroup[0].active = false;\r\n                self.methodBtnGroup[1].active = false;\r\n                self.methodBtnGroup[2].active = false;\r\n                self.methodBtnGroup[3].active = true;\r\n                return;\r\n            }\r\n        });\r\n        self.updateChoosedShow2(self)\r\n    },\r\n    updateChoosedShow2: function (self) {\r\n        if (GameApp.dataManager.getChoosedSkinId() == self.skinData.skinid) {\r\n            self.methodBtnGroup[3].children[0].active = false\r\n            self.methodBtnGroup[3].children[1].active = true\r\n        } else {\r\n            self.methodBtnGroup[3].children[0].active = true\r\n            self.methodBtnGroup[3].children[1].active = false\r\n        }\r\n    },\r\n    setpieceIcon(id) {\r\n        var self = this\r\n        cc.loader.loadRes(\"texture/skin_piece/card_p_\" + id, cc.SpriteFrame, function (err, spriteFrame) {\r\n            self.methodUIGroup[2].getComponent(cc.Sprite).spriteFrame = spriteFrame\r\n        });\r\n    },\r\n    selelctBtnClick() {\r\n        GameApp.audioManager.playEffect('click')\r\n        GameApp.dataManager.setChoosedSkinId(this.skinData.skinid)\r\n        GameApp.eventManager.emit(EventNames.EVENT_UPDATE_SHOP_CHOOSED_SHOW, this)\r\n    },\r\n    coinBtnClick() {\r\n        GameApp.audioManager.playEffect('click')\r\n        if (GameApp.dataManager.reduceCoin(this.skinData.needcoin)) {\r\n            GameApp.uiManager.showToast(\"解锁成功\")\r\n            GameApp.dataManager.unLockSkin(this.skinData.skinid)\r\n            GameApp.eventManager.emit(EventNames.EVENT_UPDATE_SHOP_CHOOSED_SHOW, this)\r\n        } else {\r\n            GameApp.uiManager.showToast(\"金币不足！\")\r\n        }\r\n    },\r\n    videoBtnClick() {\r\n        if (window.wx) {\r\n            GameApp.uiManager.showToast(\"暂未开放！\")\r\n            return\r\n        }\r\n        if (!this.onceClick) return;\r\n        this.onceClick = false\r\n        GameApp.audioManager.playEffect('click')\r\n        var self = this\r\n\r\n        if (window.tt) {\r\n            Utils.addVideo(\"addVideo\", function () { //看完了\r\n                self.onceClick = true\r\n                GameApp.dataManager.addPlayedVideoNum()\r\n                GameApp.eventManager.emit(EventNames.EVENT_UPDATE_SHOP_CHOOSED_SHOW, self)\r\n            }, function (_info) { //没看完\r\n                self.onceClick = true\r\n                _info ? GameApp.uiManager.showToast(_info) : GameApp.uiManager.showToast(\"未看完视频！\")\r\n            })\r\n        } else {\r\n            self.onceClick = true\r\n            GameApp.dataManager.addPlayedVideoNum()\r\n            GameApp.eventManager.emit(EventNames.EVENT_UPDATE_SHOP_CHOOSED_SHOW, self)\r\n        }\r\n\r\n\r\n    },\r\n    pieceBtnClick() {\r\n        GameApp.audioManager.playEffect('click')\r\n        GameApp.uiManager.showToast(\"碎片不足,请从\" + \"<color=#faf80d>黄金宝箱</color>\" + \"获取！\")\r\n    },\r\n\r\n    onCloseBtnClick() {\r\n        GameApp.audioManager.playEffect('click')\r\n        GameApp.uiManager.closePopup(\"SkinInfoPopup\")\r\n    },\r\n\r\n});\r\n"]}