{"version":3,"sources":["assets\\scripts\\ui\\OpenBoxPopup.js"],"names":["Utils","require","cc","Class","Component","properties","boxAnim","sp","Skeleton","delayShowPanel","Node","_itemType","_itemNum","_pieceIndex","onceClick","visible","onLoad","init","_skinData","_type","_num","addCoin","addPiece","initSkinShow","skeletonData","arr","i","setAnimation","setCompleteListener","length","loop","node","runAction","sequence","delayTime","callFunc","active","Tools","scaleUpAndDowm","children","sureBtnClick","window","wx","GameApp","uiManager","showToast","audioManager","playEffect","self","tt","addVideo","dataManager","addPlayedVideoNum","addPieceNum","getSkinDataById","name","closePopup","_info","skipBtnClick","getComponent","RichText","string","setpieceIcon","id","loader","loadRes","SpriteFrame","err","spriteFrame","Sprite"],"mappings":"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","sourceRoot":"/","sourcesContent":["const Utils = require(\"Utils\")\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        boxAnim: sp.Skeleton,\r\n        delayShowPanel: cc.Node, //children 0是图，1是字\r\n        _itemType: 1,\r\n        _itemNum: 0,\r\n        _pieceIndex: 0,\r\n\r\n        onceClick: {\r\n            default: true,\r\n            visible: false\r\n        }\r\n    },\r\n\r\n    onLoad() {\r\n\r\n    },\r\n    init(_skinData, _type, _num, _pieceIndex) {\r\n        this._itemType = _type\r\n        this._itemNum = _num\r\n        this._pieceIndex = _pieceIndex\r\n        switch (_type) {\r\n            case 1: this.addCoin(_num); break;\r\n            case 2: this.addPiece(_num, _pieceIndex); break;\r\n        }\r\n        this.initSkinShow(_skinData)\r\n    },\r\n    initSkinShow(_skinData) {\r\n        this.boxAnim.skeletonData = _skinData\r\n        var arr = ['appear', 'big--small', 'open', 'open_await']//, 'last_open_await'\r\n        var i = 0\r\n        this.boxAnim.setAnimation(0, arr[i++], false)\r\n        this.boxAnim.setCompleteListener(() => {\r\n            if (i > arr.length - 1) return;\r\n            var loop = (i == arr.length - 1)\r\n            if (i == arr.length - 2) {\r\n                this.node.runAction(cc.sequence(cc.delayTime(0.8), cc.callFunc(() => {\r\n                    this.delayShowPanel.active = true\r\n                    Tools.scaleUpAndDowm(this.delayShowPanel.children[2])\r\n                })))\r\n            }\r\n            this.boxAnim.setAnimation(0, arr[i++], loop)\r\n        })\r\n    },\r\n    sureBtnClick() {\r\n        if (window.wx) {\r\n            GameApp.uiManager.showToast(\"暂未开放！\")\r\n            return\r\n        }\r\n        if (!this.onceClick) return;\r\n        this.onceClick = false\r\n        GameApp.audioManager.playEffect('click')\r\n        var self = this\r\n        if (window.tt) {\r\n            Utils.addVideo(\"addVideo\", function () { //看完了\r\n                self.onceClick = true\r\n                GameApp.dataManager.addPlayedVideoNum()\r\n                switch (self._itemType) {\r\n                    case 1: GameApp.dataManager.addCoin(self._itemNum); GameApp.uiManager.showToast(\"获得金币*\" + self._itemNum * 2); break;\r\n                    case 2: GameApp.dataManager.addPieceNum(self._pieceIndex, self._itemNum); GameApp.uiManager.showToast(\"获得<color=#faf80d>\" + GameApp.dataManager.getSkinDataById(self._pieceIndex).name + \"</color> 碎片*\" + self._itemNum * 2); break;\r\n                }\r\n                GameApp.uiManager.closePopup(\"OpenBoxPopup\")\r\n            }, function (_info) { //没看完\r\n                self.onceClick = true\r\n                _info ? GameApp.uiManager.showToast(_info) : GameApp.uiManager.showToast(\"未看完视频！\")\r\n            })\r\n        } else {\r\n            self.onceClick = true\r\n            GameApp.dataManager.addPlayedVideoNum()\r\n            switch (self._itemType) {\r\n                case 1: GameApp.dataManager.addCoin(self._itemNum); GameApp.uiManager.showToast(\"获得金币*\" + self._itemNum * 2); break;\r\n                case 2: GameApp.dataManager.addPieceNum(self._pieceIndex, self._itemNum); GameApp.uiManager.showToast(\"获得<color=#faf80d>\" + GameApp.dataManager.getSkinDataById(self._pieceIndex).name + \"</color> 碎片*\" + self._itemNum * 2); break;\r\n            }\r\n            GameApp.uiManager.closePopup(\"OpenBoxPopup\")\r\n        }\r\n    },\r\n    skipBtnClick() {\r\n        GameApp.audioManager.playEffect('click')\r\n        var self = this\r\n        switch (self._itemType) {\r\n            case 1: GameApp.uiManager.showToast(\"获得金币*\" + self._itemNum); break;\r\n            case 2: GameApp.uiManager.showToast(\"获得<color=#faf80d>\" + GameApp.dataManager.getSkinDataById(self._pieceIndex).name + \"</color> 碎片*\" + self._itemNum); break;\r\n        }\r\n        GameApp.uiManager.closePopup(\"OpenBoxPopup\")\r\n    },\r\n    addCoin(_num) {\r\n        this.delayShowPanel.children[1].getComponent(cc.RichText).string = \"金币*\" + _num\r\n    },\r\n    addPiece(_num, _pieceIndex) {\r\n        this.setpieceIcon(_pieceIndex);\r\n        this.delayShowPanel.children[1].getComponent(cc.RichText).string = \"<color=#faf80d>\" + GameApp.dataManager.getSkinDataById(_pieceIndex).name + \"</color> 碎片*\" + _num\r\n    },\r\n    setpieceIcon(id) {\r\n        var self = this\r\n        cc.loader.loadRes(\"texture/skin_piece/card_p_\" + id, cc.SpriteFrame, function (err, spriteFrame) {\r\n            self.delayShowPanel.children[0].getComponent(cc.Sprite).spriteFrame = spriteFrame\r\n        });\r\n    },\r\n});\r\n"]}